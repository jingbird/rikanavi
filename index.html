<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>りかナビ - 中学理科学習ナビゲーター</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .domain-energy { background-color: #FF6B6B; }
        .domain-particle { background-color: #4ECDC4; }
        .domain-life { background-color: #45B7D1; }
        .domain-earth { background-color: #96CEB4; }
        .domain-energy-light { background-color: #FFE5E5; border-color: #FF6B6B; }
        .domain-particle-light { background-color: #E5F9F7; border-color: #4ECDC4; }
        .domain-life-light { background-color: #E5F4F8; border-color: #45B7D1; }
        .domain-earth-light { background-color: #EDF7F2; border-color: #96CEB4; }
        .chapter-completed { opacity: 1; }
        .chapter-incomplete { opacity: 0.6; }
        .chapter-current { box-shadow: 0 0 0 3px #FFA500; }
        .progress-ring { transform: rotate(-90deg); }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
        // 確認テストデータ（全46章×5問=230問）
        const quizData = {
            "1-1-1": [
                {id: 1, level: "basic", question: "生物を観察するときに使う、小さなものを拡大して見る道具を何というか。", options: ["顕微鏡", "望遠鏡", "虫めがね", "プリズム"], answer: 0, explanation: "顕微鏡は小さな生物や細胞を拡大して観察するための道具です。"},
                {id: 2, level: "basic", question: "生物を特徴によってグループ分けすることを何というか。", options: ["分類", "観察", "実験", "記録"], answer: 0, explanation: "分類とは、生物を共通の特徴によってグループ分けすることです。"},
                {id: 3, level: "normal", question: "顕微鏡で観察するとき、最初に使うのはどのレンズか。", options: ["低倍率の対物レンズ", "高倍率の対物レンズ", "接眼レンズのみ", "どれでもよい"], answer: 0, explanation: "最初は低倍率で全体を確認し、その後必要に応じて高倍率に変えます。"},
                {id: 4, level: "normal", question: "野外で生物を観察するとき、記録として残しておくべきものはどれか。", options: ["日時・場所・天気・スケッチ", "自分の感想だけ", "生物の名前だけ", "場所だけ"], answer: 0, explanation: "観察記録には、日時・場所・天気・スケッチなど、できるだけ多くの情報を残します。"},
                {id: 5, level: "advanced", question: "同じ池で採取した水の中に、緑色の生物と透明な生物がいた。これらを分類するとき、最も適切な基準は何か。", options: ["光合成をするかどうか", "大きさ", "動くかどうか", "水の中にいるかどうか"], answer: 0, explanation: "緑色の生物は葉緑体を持ち光合成をする植物的な生物、透明なものは光合成をしない動物的な生物として分類できます。"},
            ],
            "1-1-2": [
                {id: 1, level: "basic", question: "花が咲いて種子をつくる植物を何というか。", options: ["種子植物", "シダ植物", "コケ植物", "藻類"], answer: 0, explanation: "種子植物は花を咲かせ、種子によって増える植物です。"},
                {id: 2, level: "basic", question: "被子植物の花で、めしべの根元にある、種子になる部分を何というか。", options: ["胚珠", "子房", "花粉", "やく"], answer: 0, explanation: "胚珠は受粉後に種子になる部分です。"},
                {id: 3, level: "normal", question: "次のうち、単子葉類の特徴として正しいものはどれか。", options: ["葉脈が平行", "葉脈が網目状", "根が主根と側根", "子葉が2枚"], answer: 0, explanation: "単子葉類は葉脈が平行で、ひげ根を持ち、子葉が1枚です。"},
                {id: 4, level: "normal", question: "マツやスギのように、胚珠がむき出しになっている植物を何というか。", options: ["裸子植物", "被子植物", "シダ植物", "コケ植物"], answer: 0, explanation: "裸子植物は胚珠が子房に包まれておらず、むき出しになっています。"},
                {id: 5, level: "advanced", question: "アサガオとイネを比べたとき、根のつくりが異なる理由として最も適切なものはどれか。", options: ["子葉の数が違うから", "花の色が違うから", "生育する場所が違うから", "種子の大きさが違うから"], answer: 0, explanation: "アサガオは双子葉類（子葉2枚）で主根・側根、イネは単子葉類（子葉1枚）でひげ根を持ちます。"},
            ],
            "1-1-3": [
                {id: 1, level: "basic", question: "背骨を持つ動物を何というか。", options: ["セキツイ動物", "無セキツイ動物", "節足動物", "軟体動物"], answer: 0, explanation: "セキツイ動物は背骨（脊椎）を持つ動物のグループです。"},
                {id: 2, level: "basic", question: "次のうち、哺乳類の特徴はどれか。", options: ["子を母乳で育てる", "卵を産む", "えら呼吸をする", "体温が変化する"], answer: 0, explanation: "哺乳類は胎生で子を産み、母乳で育てます。"},
                {id: 3, level: "normal", question: "カエルは幼生（オタマジャクシ）のときと成体で呼吸の方法が変わる。成体の呼吸方法は何か。", options: ["肺呼吸と皮膚呼吸", "えら呼吸のみ", "肺呼吸のみ", "皮膚呼吸のみ"], answer: 0, explanation: "カエルの成体は肺呼吸と皮膚呼吸の両方を行います。"},
                {id: 4, level: "normal", question: "昆虫のからだは、頭部・胸部ともう1つは何か。", options: ["腹部", "尾部", "首部", "背部"], answer: 0, explanation: "昆虫のからだは頭部・胸部・腹部の3つの部分からなります。"},
                {id: 5, level: "advanced", question: "魚類・両生類・爬虫類は変温動物である。この特徴の利点として最も適切なものはどれか。", options: ["体温維持にエネルギーを使わなくてよい", "寒い場所でも活発に動ける", "食べ物を多く必要とする", "体が大きくなりやすい"], answer: 0, explanation: "変温動物は体温を維持するエネルギーが不要なため、少ない食料で生きられます。"},
            ],
            "1-2-1": [
                {id: 1, level: "basic", question: "物質1cm³あたりの質量を何というか。", options: ["密度", "体積", "重さ", "濃度"], answer: 0, explanation: "密度は物質1cm³あたりの質量で、物質を区別する手がかりになります。"},
                {id: 2, level: "basic", question: "金属に共通する性質として正しいものはどれか。", options: ["電気を通す", "電気を通さない", "水に浮く", "燃えない"], answer: 0, explanation: "金属は電気を通す、熱を伝えやすい、たたくと広がるなどの共通の性質を持ちます。"},
                {id: 3, level: "normal", question: "砂糖を加熱し続けるとどうなるか。", options: ["黒くこげて炭になる", "沸騰して気体になる", "変化しない", "金属光沢が出る"], answer: 0, explanation: "砂糖は有機物なので、加熱すると黒くこげて炭（炭素）になります。"},
                {id: 4, level: "normal", question: "ある物質の質量が27g、体積が10cm³のとき、密度はいくらか。", options: ["2.7g/cm³", "27g/cm³", "270g/cm³", "0.27g/cm³"], answer: 0, explanation: "密度＝質量÷体積＝27g÷10cm³＝2.7g/cm³です。"},
                {id: 5, level: "advanced", question: "同じ体積の鉄球とアルミニウム球を水に入れた。両方とも沈んだが、より速く沈むのはどちらか。また、その理由は何か。", options: ["鉄球。密度が大きいから", "アルミニウム球。密度が大きいから", "同じ速さで沈む", "鉄球。体積が大きいから"], answer: 0, explanation: "鉄の密度（約7.9g/cm³）はアルミニウム（約2.7g/cm³）より大きいため、同じ体積なら鉄の方が重く、速く沈みます。"},
            ],
            "1-2-2": [
                {id: 1, level: "basic", question: "水に溶けにくく、空気より軽い気体を集める方法を何というか。", options: ["水上置換法", "上方置換法", "下方置換法", "蒸留法"], answer: 0, explanation: "水上置換法は、水に溶けにくい気体を水の中で集める方法です。"},
                {id: 2, level: "basic", question: "酸素の性質として正しいものはどれか。", options: ["ものを燃やすはたらきがある", "石灰水を白くにごらせる", "刺激臭がある", "空気より軽い"], answer: 0, explanation: "酸素は自身は燃えませんが、ものを燃やすはたらき（助燃性）があります。"},
                {id: 3, level: "normal", question: "二酸化炭素を発生させるのに適した組み合わせはどれか。", options: ["石灰石とうすい塩酸", "亜鉛とうすい塩酸", "二酸化マンガンと過酸化水素水", "鉄とうすい硫酸"], answer: 0, explanation: "石灰石（�ite灰石）にうすい塩酸を加えると二酸化炭素が発生します。"},
                {id: 4, level: "normal", question: "アンモニアの性質として正しいものはどれか。", options: ["水に非常によく溶け、水溶液はアルカリ性を示す", "水に溶けにくい", "無色無臭である", "空気より重い"], answer: 0, explanation: "アンモニアは水に非常によく溶け、その水溶液（アンモニア水）はアルカリ性を示します。"},
                {id: 5, level: "advanced", question: "水素と酸素の混合気体に火をつけると爆発的に反応する。この反応で生成する物質は何か。", options: ["水", "二酸化炭素", "塩化水素", "アンモニア"], answer: 0, explanation: "水素と酸素が反応すると水（H₂O）が生成されます。これは燃料電池の原理にも使われています。"},
            ],
            "1-2-3": [
                {id: 1, level: "basic", question: "物質が水に溶けて均一に混ざった液体を何というか。", options: ["水溶液", "懸濁液", "乳濁液", "混合物"], answer: 0, explanation: "水溶液は、物質が水に溶けて均一に混ざった透明な液体です。"},
                {id: 2, level: "basic", question: "水溶液において、溶けている物質を何というか。", options: ["溶質", "溶媒", "溶液", "飽和"], answer: 0, explanation: "溶質は水溶液に溶けている物質、溶媒は溶かしている液体（水）のことです。"},
                {id: 3, level: "normal", question: "100gの水に25gの砂糖を溶かした。この砂糖水の質量パーセント濃度は何%か。", options: ["20%", "25%", "30%", "125%"], answer: 0, explanation: "質量パーセント濃度＝溶質÷水溶液×100＝25÷125×100＝20%です。"},
                {id: 4, level: "normal", question: "水の温度を上げると、一般的に固体の溶解度はどうなるか。", options: ["大きくなる", "小さくなる", "変わらない", "物質によって異なり、規則性はない"], answer: 0, explanation: "一般的に、水の温度が上がると固体の溶解度は大きくなります。"},
                {id: 5, level: "advanced", question: "飽和水溶液を冷却したとき、溶けきれなくなった溶質が結晶として出てくる現象を利用して、物質を純粋に取り出す方法を何というか。", options: ["再結晶", "蒸留", "ろ過", "蒸発"], answer: 0, explanation: "再結晶は、溶解度の温度による変化を利用して、純粋な結晶を取り出す方法です。"},
            ],
            "1-2-4": [
                {id: 1, level: "basic", question: "物質が固体から液体に変化することを何というか。", options: ["融解", "凝固", "蒸発", "凝縮"], answer: 0, explanation: "融解は固体が液体に変化すること、凝固は液体が固体に変化することです。"},
                {id: 2, level: "basic", question: "水が沸騰するときの温度を何というか。", options: ["沸点", "融点", "凝固点", "臨界点"], answer: 0, explanation: "沸点は液体が沸騰して気体に変わる温度で、水の場合は100℃（1気圧）です。"},
                {id: 3, level: "normal", question: "状態変化のとき、物質の何が変化するか。", options: ["粒子の運動のようす", "粒子の種類", "粒子の数", "粒子の質量"], answer: 0, explanation: "状態変化では粒子の種類や数は変わらず、粒子の運動のようす（動きの激しさ）が変化します。"},
                {id: 4, level: "normal", question: "エタノールと水の混合物を分離するのに適した方法はどれか。", options: ["蒸留", "ろ過", "再結晶", "蒸発"], answer: 0, explanation: "蒸留は沸点の違いを利用して液体の混合物を分離する方法です。"},
                {id: 5, level: "advanced", question: "ロウが固体から液体に変わるとき、体積はどうなるか。また、その理由は何か。", options: ["大きくなる。粒子の間隔が広がるから", "小さくなる。粒子が収縮するから", "変わらない。粒子の数が同じだから", "大きくなる。粒子の数が増えるから"], answer: 0, explanation: "融解すると粒子の動きが活発になり、粒子の間隔が広がるため体積は大きくなります。"},
            ],
            "1-3-1": [
                {id: 1, level: "basic", question: "光が物体の表面ではね返る現象を何というか。", options: ["反射", "屈折", "分散", "干渉"], answer: 0, explanation: "反射は光が物体の表面ではね返る現象です。"},
                {id: 2, level: "basic", question: "光が空気中から水中に進むとき、境界面で曲がる現象を何というか。", options: ["屈折", "反射", "直進", "分散"], answer: 0, explanation: "屈折は光が異なる物質の境界面で曲がる現象です。"},
                {id: 3, level: "normal", question: "光が鏡で反射するとき、入射角と反射角の関係はどうなるか。", options: ["入射角＝反射角", "入射角＞反射角", "入射角＜反射角", "関係はない"], answer: 0, explanation: "光の反射では、入射角と反射角は常に等しくなります（反射の法則）。"},
                {id: 4, level: "normal", question: "凸レンズで、焦点より外側に物体を置いたとき、できる像はどのような像か。", options: ["実像（上下左右が逆）", "虚像（上下左右が同じ）", "像はできない", "実像（上下左右が同じ）"], answer: 0, explanation: "焦点より外側に物体を置くと、上下左右が逆の実像ができます。"},
                {id: 5, level: "advanced", question: "水中から空気中へ光が進むとき、入射角をある角度以上にすると光は全て反射して空気中に出なくなる。この現象を何というか。", options: ["全反射", "乱反射", "拡散", "散乱"], answer: 0, explanation: "全反射は、光が密度の大きい物質から小さい物質へ進むとき、ある角度以上で起こる現象です。光ファイバーに利用されています。"},
            ],
            "1-3-2": [
                {id: 1, level: "basic", question: "音を伝えるもの（空気など）を何というか。", options: ["媒質", "振動数", "振幅", "波長"], answer: 0, explanation: "媒質は音や波を伝える物質のことで、音の場合は空気や水などが媒質となります。"},
                {id: 2, level: "basic", question: "音の高さを決めるものは何か。", options: ["振動数", "振幅", "媒質", "波長"], answer: 0, explanation: "音の高さは振動数（1秒間に振動する回数）で決まり、振動数が多いほど高い音になります。"},
                {id: 3, level: "normal", question: "音の大きさを決めるものは何か。", options: ["振幅", "振動数", "速さ", "波長"], answer: 0, explanation: "音の大きさは振幅（振動の幅）で決まり、振幅が大きいほど大きな音になります。"},
                {id: 4, level: "normal", question: "空気中の音の速さは約何m/sか。", options: ["約340m/s", "約34m/s", "約3400m/s", "約3.4m/s"], answer: 0, explanation: "空気中の音の速さは約340m/sです。光の速さ（約30万km/s）と比べてとても遅いです。"},
                {id: 5, level: "advanced", question: "雷が光ってから3秒後に音が聞こえた。雷までの距離はおよそ何mか。", options: ["約1020m", "約340m", "約102m", "約3400m"], answer: 0, explanation: "音の速さ×時間＝340m/s×3s＝1020mです。光はほぼ瞬時に届くので、音の遅れから距離がわかります。"},
            ],
            "1-4-1": [
                {id: 1, level: "basic", question: "力の単位は何か。", options: ["N（ニュートン）", "g（グラム）", "m（メートル）", "Pa（パスカル）"], answer: 0, explanation: "力の単位はN（ニュートン）です。約100gの物体にはたらく重力が約1Nです。"},
                {id: 2, level: "basic", question: "ばねを引く力を2倍にすると、ばねの伸びはどうなるか。", options: ["2倍になる", "変わらない", "4倍になる", "半分になる"], answer: 0, explanation: "ばねの伸びは加えた力に比例します。これをフックの法則といいます。"},
                {id: 3, level: "normal", question: "力を表すときに必要な3つの要素は何か。", options: ["大きさ・向き・作用点", "大きさ・速さ・時間", "向き・速さ・質量", "大きさ・質量・体積"], answer: 0, explanation: "力は大きさ・向き・作用点の3つの要素で表されます。"},
                {id: 4, level: "normal", question: "2つの力がつり合う条件として正しいものはどれか。", options: ["同一直線上で、大きさが等しく、向きが反対", "大きさが等しく、同じ向き", "同一直線上で、大きさが違う", "向きが同じで、大きさが反対"], answer: 0, explanation: "2力がつり合うには、同一直線上にあり、大きさが等しく、向きが反対である必要があります。"},
                {id: 5, level: "advanced", question: "質量1kgの物体にはたらく重力は地球上で約何Nか。", options: ["約10N", "約1N", "約100N", "約0.1N"], answer: 0, explanation: "地球上では、質量1kgの物体にはたらく重力は約9.8N≒約10Nです。"},
            ],
            "1-4-2": [
                {id: 1, level: "basic", question: "火山の地下にある、高温でドロドロに溶けた岩石を何というか。", options: ["マグマ", "溶岩", "火山灰", "火山弾"], answer: 0, explanation: "マグマは地下深くにある高温で溶けた岩石です。地表に出たものを溶岩といいます。"},
                {id: 2, level: "basic", question: "マグマが地表付近で急に冷えてできた岩石を何というか。", options: ["火山岩", "深成岩", "堆積岩", "変成岩"], answer: 0, explanation: "火山岩はマグマが急に冷えてできた岩石で、斑状組織を持ちます。"},
                {id: 3, level: "normal", question: "マグマのねばりけが小さい火山の形はどのようになるか。", options: ["傾斜がゆるやかな形", "傾斜が急な形", "ドーム状の形", "円すい形"], answer: 0, explanation: "ねばりけが小さいマグマは流れやすいので、傾斜がゆるやかな火山になります。"},
                {id: 4, level: "normal", question: "花こう岩は深成岩である。その特徴的な組織を何というか。", options: ["等粒状組織", "斑状組織", "層状組織", "流状組織"], answer: 0, explanation: "深成岩はマグマがゆっくり冷えてできるため、同じくらいの大きさの結晶からなる等粒状組織を持ちます。"},
                {id: 5, level: "advanced", question: "火山岩の斑状組織において、大きな結晶（斑晶）ができた場所と、細かい部分（石基）ができた場所はそれぞれどこか。", options: ["斑晶は地下深く、石基は地表付近", "斑晶は地表付近、石基は地下深く", "どちらも地表付近", "どちらも地下深く"], answer: 0, explanation: "斑晶は地下深くでゆっくり成長し、石基は噴火後に地表付近で急に冷えてできました。"},
            ],
            "1-4-3": [
                {id: 1, level: "basic", question: "地震のゆれが発生した場所を何というか。", options: ["震源", "震央", "震度", "マグニチュード"], answer: 0, explanation: "震源は地震が発生した地下の場所で、震央は震源の真上の地表の地点です。"},
                {id: 2, level: "basic", question: "地震の規模を表す尺度を何というか。", options: ["マグニチュード", "震度", "震央", "震源"], answer: 0, explanation: "マグニチュードは地震そのものの規模を表し、震度は場所ごとのゆれの大きさを表します。"},
                {id: 3, level: "normal", question: "地震のゆれで、最初に届く小さなゆれを何というか。", options: ["初期微動", "主要動", "余震", "前震"], answer: 0, explanation: "初期微動は速いP波によるゆれで、その後に大きな主要動（S波）が届きます。"},
                {id: 4, level: "normal", question: "プレートの境界で、海のプレートが陸のプレートの下にしずみ込む場所で起こりやすい地震の原因は何か。", options: ["プレートのひずみが限界に達して跳ね返る", "マグマの上昇", "地下水の増加", "プレートの上昇"], answer: 0, explanation: "沈み込むプレートに引きずられた陸のプレートが、限界に達して跳ね返ることで地震が発生します。"},
                {id: 5, level: "advanced", question: "ある地点でP波が届いてからS波が届くまでの時間（初期微動継続時間）が長いほど、何がわかるか。", options: ["震源からの距離が遠い", "地震の規模が大きい", "震源が深い", "震度が大きい"], answer: 0, explanation: "P波とS波の速さの差は一定なので、初期微動継続時間が長いほど震源からの距離が遠いことがわかります。"},
            ],
            "1-4-4": [
                {id: 1, level: "basic", question: "流水のはたらきなどで運ばれた土砂が積もってできた岩石を何というか。", options: ["堆積岩", "火成岩", "変成岩", "火山岩"], answer: 0, explanation: "堆積岩は土砂などが積もり、長い年月をかけて固まってできた岩石です。"},
                {id: 2, level: "basic", question: "地層に含まれる、過去の生物の遺骸や生活のあとを何というか。", options: ["化石", "鉱物", "結晶", "火山灰"], answer: 0, explanation: "化石は過去の生物の体や生活のあとが地層中に残ったものです。"},
                {id: 3, level: "normal", question: "サンゴの化石が見つかった地層ができた当時の環境として考えられるものはどれか。", options: ["暖かく浅い海", "冷たく深い海", "川の流域", "陸上"], answer: 0, explanation: "サンゴは暖かく浅い海に生息するので、サンゴの化石は当時そこが暖かく浅い海だったことを示します。"},
                {id: 4, level: "normal", question: "限られた時代に広い範囲で生息していた生物の化石を何というか。", options: ["示準化石", "示相化石", "生痕化石", "微化石"], answer: 0, explanation: "示準化石は地層ができた時代を知る手がかりになる化石です。アンモナイトなどが代表例です。"},
                {id: 5, level: "advanced", question: "れき岩・砂岩・泥岩は堆積岩だが、粒の大きさの順に並べると正しいのはどれか。", options: ["れき岩＞砂岩＞泥岩", "泥岩＞砂岩＞れき岩", "砂岩＞れき岩＞泥岩", "泥岩＞れき�ite＞砂岩"], answer: 0, explanation: "れき（2mm以上）＞砂（2mm～0.06mm）＞泥（0.06mm以下）の順に粒が大きいです。"},
            ],
            "2-1-1": [
                {id: 1, level: "basic", question: "物質をつくっている最小の粒子を何というか。", options: ["原子", "分子", "イオン", "電子"], answer: 0, explanation: "原子は物質をつくっている最小の粒子で、それ以上分けることができません。"},
                {id: 2, level: "basic", question: "水の化学式はどれか。", options: ["H₂O", "CO₂", "NaCl", "O₂"], answer: 0, explanation: "水は水素原子2つと酸素原子1つからできており、H₂Oと表します。"},
                {id: 3, level: "normal", question: "1種類の原子だけでできている物質を何というか。", options: ["単体", "化合物", "混合物", "分子"], answer: 0, explanation: "単体は1種類の原子だけでできている物質で、酸素（O₂）や鉄（Fe）などがあります。"},
                {id: 4, level: "normal", question: "水を電気分解すると、陰極から発生する気体は何か。", options: ["水素", "酸素", "二酸化炭素", "窒素"], answer: 0, explanation: "水の電気分解では、陰極から水素、陽極から酸素が発生します。水素と酸素の体積比は2:1です。"},
                {id: 5, level: "advanced", question: "炭酸水素ナトリウムを加熱すると、炭酸ナトリウム・水・二酸化炭素に分解される。この反応のように、1種類の物質が2種類以上の物質に分かれる化学変化を何というか。", options: ["分解", "化合", "酸化", "還元"], answer: 0, explanation: "分解は1種類の物質が2種類以上の物質に分かれる化学変化です。"},
            ],
            "2-1-2": [
                {id: 1, level: "basic", question: "2種類以上の物質が結びついて別の物質ができる化学変化を何というか。", options: ["化合", "分解", "中和", "電離"], answer: 0, explanation: "化合は2種類以上の物質が結びついて新しい物質ができる化学変化です。"},
                {id: 2, level: "basic", question: "化学変化を式で表したものを何というか。", options: ["化学反応式", "化学式", "元素記号", "分子式"], answer: 0, explanation: "化学反応式は化学変化を化学式を使って表したものです。"},
                {id: 3, level: "normal", question: "鉄と硫黄の混合物を加熱してできる物質は何か。", options: ["硫化鉄", "酸化鉄", "塩化鉄", "鉄と硫黄"], answer: 0, explanation: "鉄と硫黄を加熱すると化合して硫化鉄という新しい物質ができます。"},
                {id: 4, level: "normal", question: "化学反応式「2H₂ + O₂ → 2H₂O」で、矢印の左側を何というか。", options: ["反応物", "生成物", "触媒", "原料"], answer: 0, explanation: "矢印の左側が反応物（反応前の物質）、右側が生成物（反応後の物質）です。"},
                {id: 5, level: "advanced", question: "銅と硫黄を加熱すると硫化銅ができる。このとき、銅原子と硫黄原子は何対何の割合で結びつくか。", options: ["1:1", "2:1", "1:2", "2:3"], answer: 0, explanation: "硫化銅の化学式はCuSで、銅原子と硫黄原子が1:1の割合で結びついています。"},
            ],
            "2-1-3": [
                {id: 1, level: "basic", question: "物質が酸素と結びつく化学変化を何というか。", options: ["酸化", "還元", "分解", "中和"], answer: 0, explanation: "酸化は物質が酸素と結びつく化学変化です。"},
                {id: 2, level: "basic", question: "酸化物から酸素を取り除く化学変化を何というか。", options: ["還元", "酸化", "化合", "分解"], answer: 0, explanation: "還元は酸化物から酸素を取り除く化学変化です。酸化と還元は同時に起こります。"},
                {id: 3, level: "normal", question: "スチールウール（鉄）を燃やすと質量が増える。その理由として正しいものはどれか。", options: ["空気中の酸素と結びついたから", "熱を吸収したから", "水分を吸収したから", "燃えカスが加わったから"], answer: 0, explanation: "鉄が燃えると空気中の酸素と結びついて酸化鉄になるため、酸素の分だけ質量が増えます。"},
                {id: 4, level: "normal", question: "酸化銅と炭素の混合物を加熱すると、銅と二酸化炭素ができる。この反応で還元されたのはどれか。", options: ["酸化銅", "炭素", "銅", "二酸化炭素"], answer: 0, explanation: "酸化銅は酸素を失って銅になったので還元されました。炭素は酸素を得たので酸化されました。"},
                {id: 5, level: "advanced", question: "有機物が燃えると二酸化炭素と水ができる。これは有機物に含まれる何という元素が酸化されたからか。", options: ["炭素と水素", "炭素と酸素", "水素と酸素", "窒素と水素"], answer: 0, explanation: "有機物に含まれる炭素が酸化されて二酸化炭素に、水素が酸化されて水になります。"},
            ],
            "2-1-4": [
                {id: 1, level: "basic", question: "化学変化の前後で、物質全体の質量は変わらない。この法則を何というか。", options: ["質量保存の法則", "定比例の法則", "フックの法則", "万有引力の法則"], answer: 0, explanation: "質量保存の法則は、化学変化の前後で物質全体の質量が変わらないという法則です。"},
                {id: 2, level: "basic", question: "化合物をつくる元素の質量比は常に一定である。この法則を何というか。", options: ["定比例の法則", "質量保存の法則", "倍数比例の法則", "気体反応の法則"], answer: 0, explanation: "定比例の法則は、化合物をつくる元素の質量比が常に一定であるという法則です。"},
                {id: 3, level: "normal", question: "銅と酸素が化合するとき、銅と酸素の質量比は何対何か。", options: ["4:1", "1:1", "2:1", "1:2"], answer: 0, explanation: "銅と酸素は4:1の質量比で化合して酸化銅（CuO）になります。"},
                {id: 4, level: "normal", question: "マグネシウム3gを完全に燃焼させると、酸化マグネシウムは何gできるか。（マグネシウム：酸素＝3:2）", options: ["5g", "3g", "6g", "2g"], answer: 0, explanation: "マグネシウム3gに対し酸素は2g結びつくので、酸化マグネシウムは3+2=5gできます。"},
                {id: 5, level: "advanced", question: "密閉した容器の中で化学変化を起こしても質量が変わらないのに、開いた容器で鉄を燃やすと質量が増えるのはなぜか。", options: ["空気中から酸素が加わるから", "熱が加わるから", "光が加わるから", "水蒸気が加わるから"], answer: 0, explanation: "開いた容器では空気中の酸素が反応に加わるため、質量が増加したように見えます。全体で見れば質量は保存されています。"},
            ],
            "2-1-5": [
                {id: 1, level: "basic", question: "化学変化にともなって熱が発生する反応を何というか。", options: ["発熱反応", "吸熱反応", "中和反応", "酸化反応"], answer: 0, explanation: "発熱反応は化学変化にともなって熱が発生する反応です。"},
                {id: 2, level: "basic", question: "化学変化にともなって熱を吸収する反応を何というか。", options: ["吸熱反応", "発熱反応", "中和反応", "還元反応"], answer: 0, explanation: "吸熱反応は化学変化にともなって周囲から熱を吸収する反応です。"},
                {id: 3, level: "normal", question: "次のうち、発熱反応はどれか。", options: ["鉄粉と活性炭の反応（使い捨てカイロ）", "炭酸水素ナトリウムとクエン酸の反応", "水の電気分解", "光合成"], answer: 0, explanation: "使い捨てカイロは鉄の酸化反応で、発熱反応の代表例です。"},
                {id: 4, level: "normal", question: "化学エネルギーを電気エネルギーに変換する装置を何というか。", options: ["化学電池", "モーター", "発電機", "蓄電器"], answer: 0, explanation: "化学電池は化学変化によって化学エネルギーを電気エネルギーに変換します。"},
                {id: 5, level: "advanced", question: "塩化アンモニウムと水酸化バリウムを混ぜると温度が下がる。このとき起こっているエネルギーの変化を説明したものとして正しいのはどれか。", options: ["周囲から熱エネルギーを吸収して化学エネルギーに変わる", "化学エネルギーが熱エネルギーに変わる", "化学エネルギーが電気エネルギーに変わる", "熱エネルギーが光エネルギーに変わる"], answer: 0, explanation: "吸熱反応では、周囲から熱エネルギーを吸収して化学エネルギーに変換されるため、温度が下がります。"},
            ],
            "2-2-1": [
                {id: 1, level: "basic", question: "生物のからだをつくっている基本単位を何というか。", options: ["細胞", "組織", "器官", "原子"], answer: 0, explanation: "細胞は生物のからだをつくる基本単位で、すべての生物は細胞からできています。"},
                {id: 2, level: "basic", question: "植物細胞にあって動物細胞にないものはどれか。", options: ["細胞壁", "核", "細胞膜", "細胞質"], answer: 0, explanation: "細胞壁は植物細胞の外側にある丈夫な壁で、動物細胞にはありません。"},
                {id: 3, level: "normal", question: "細胞の中で、遺伝情報を含む部分を何というか。", options: ["核", "葉緑体", "ミトコンドリア", "液胞"], answer: 0, explanation: "核は細胞の中心にあり、DNAという遺伝情報を含んでいます。"},
                {id: 4, level: "normal", question: "植物細胞で光合成を行う緑色の粒を何というか。", options: ["葉緑体", "ミトコンドリア", "液胞", "リボソーム"], answer: 0, explanation: "葉緑体は植物細胞にある緑色の粒で、光合成を行います。"},
                {id: 5, level: "advanced", question: "単細胞生物と多細胞生物の違いとして正しいものはどれか。", options: ["単細胞生物は1つの細胞ですべての生命活動を行う", "単細胞生物は核を持たない", "多細胞生物は細胞壁を持たない", "多細胞生物は光合成ができない"], answer: 0, explanation: "単細胞生物は1つの細胞ですべての生命活動を行い、多細胞生物は多くの細胞が役割分担しています。"},
            ],
            "2-2-2": [
                {id: 1, level: "basic", question: "植物が光のエネルギーを使ってデンプンなどを作るはたらきを何というか。", options: ["光合成", "呼吸", "蒸散", "吸収"], answer: 0, explanation: "光合成は、葉緑体で光のエネルギーを使って二酸化炭素と水からデンプンと酸素を作るはたらきです。"},
                {id: 2, level: "basic", question: "植物の葉の裏側に多くある、気体の出入り口を何というか。", options: ["気孔", "道管", "師管", "表皮"], answer: 0, explanation: "気孔は葉の裏側に多くあり、二酸化炭素や酸素、水蒸気の出入り口になっています。"},
                {id: 3, level: "normal", question: "根から吸収した水や養分が通る管を何というか。", options: ["道管", "師管", "気孔", "根毛"], answer: 0, explanation: "道管は根から吸収した水や養分（無機物）が通る管です。葉で作られた養分は師管を通ります。"},
                {id: 4, level: "normal", question: "植物が気孔から水蒸気を出すはたらきを何というか。", options: ["蒸散", "光合成", "呼吸", "吸水"], answer: 0, explanation: "蒸散は植物が気孔から水蒸気を出すはたらきで、根からの水の吸い上げを助けています。"},
                {id: 5, level: "advanced", question: "植物は昼も夜も呼吸をしているが、昼間は光合成の量が呼吸の量より多い。このとき、植物全体として見ると、二酸化炭素と酸素の出入りはどうなるか。", options: ["二酸化炭素を吸収し、酸素を放出する", "二酸化炭素を放出し、酸素を吸収する", "二酸化炭素も酸素も吸収する", "二酸化炭素も酸素も放出する"], answer: 0, explanation: "昼間は光合成が呼吸を上回るので、植物全体として二酸化炭素を吸収し酸素を放出します。"},
            ],
            "2-2-3": [
                {id: 1, level: "basic", question: "食べ物を体内で分解し、吸収しやすい形にするはたらきを何というか。", options: ["消化", "吸収", "排出", "呼吸"], answer: 0, explanation: "消化は食べ物を分解して、体に吸収しやすい形にするはたらきです。"},
                {id: 2, level: "basic", question: "血液中で酸素を運ぶはたらきをする成分は何か。", options: ["赤血球", "白血球", "血小板", "血しょう"], answer: 0, explanation: "赤血球はヘモグロビンを含み、酸素を運ぶはたらきをしています。"},
                {id: 3, level: "normal", question: "肺で血液中に取り込まれた酸素は、どのようにして全身の細胞に届けられるか。", options: ["心臓から動脈を通って全身へ送られる", "静脈を通って全身へ送られる", "リンパ管を通って送られる", "神経を通って送られる"], answer: 0, explanation: "酸素を含んだ血液は心臓から動脈を通って全身の細胞に届けられます。"},
                {id: 4, level: "normal", question: "血液中の不要物をこしとって尿をつくる器官は何か。", options: ["腎臓", "肝臓", "心臓", "すい臓"], answer: 0, explanation: "腎臓は血液中の不要物をこしとって尿をつくり、体外に排出する器官です。"},
                {id: 5, level: "advanced", question: "小腸の内壁にある小さな突起（柔毛）のはたらきとして正しいものはどれか。", options: ["表面積を大きくして吸収効率を高める", "消化液を分泌する", "食べ物を細かくする", "水分を吸収する"], answer: 0, explanation: "柔毛は小腸の表面積を大きくし、栄養分の吸収効率を高めるはたらきがあります。"},
            ],
            "2-2-4": [
                {id: 1, level: "basic", question: "外からの刺激を受け取る器官を何というか。", options: ["感覚器官", "運動器官", "消化器官", "呼吸器官"], answer: 0, explanation: "感覚器官は目・耳・鼻・舌・皮膚など、外からの刺激を受け取る器官です。"},
                {id: 2, level: "basic", question: "脳やせきずいからなる神経を何というか。", options: ["中枢神経", "末しょう神経", "感覚神経", "運動神経"], answer: 0, explanation: "中枢神経は脳とせきずいからなり、情報を処理して指令を出します。"},
                {id: 3, level: "normal", question: "熱いものに触れたとき、考える前に手を引っ込める反応を何というか。", options: ["反射", "意識的な反応", "本能", "学習"], answer: 0, explanation: "反射は脳を経由せずせきずいで処理される無意識の反応で、危険から身を守ります。"},
                {id: 4, level: "normal", question: "刺激を受けてから反応するまでの経路として正しいものはどれか。", options: ["感覚器官→感覚神経→中枢神経→運動神経→運動器官", "運動器官→運動神経→中枢神経→感覚神経→感覚器官", "感覚器官→運動神経→中枢神経→感覚神経→運動器官", "中枢神経→感覚器官→感覚神経→運動神経→運動器官"], answer: 0, explanation: "刺激は感覚器官で受け取り、感覚神経→中枢神経→運動神経→運動器官の順に伝わります。"},
                {id: 5, level: "advanced", question: "反射が意識的な反応より速い理由として正しいものはどれか。", options: ["脳を経由せず、せきずいで処理されるから", "神経が太いから", "筋肉が強いから", "感覚器官が敏感だから"], answer: 0, explanation: "反射は脳まで信号が行かずせきずいで処理されるため、経路が短く反応が速くなります。"},
            ],
            "2-3-1": [
                {id: 1, level: "basic", question: "気温・湿度・気圧・風向・風力などを観測することを何というか。", options: ["気象観測", "天体観測", "地震観測", "環境観測"], answer: 0, explanation: "気象観測は気温・湿度・気圧・風向・風力などの大気の状態を観測することです。"},
                {id: 2, level: "basic", question: "大気の圧力を何というか。", options: ["気圧", "水圧", "大気圧", "圧力"], answer: 0, explanation: "気圧は大気（空気）の重さによる圧力で、単位はhPa（ヘクトパスカル）です。"},
                {id: 3, level: "normal", question: "乾湿計で、乾球と湿球の示度の差が大きいとき、湿度はどうなっているか。", options: ["低い", "高い", "変わらない", "測定できない"], answer: 0, explanation: "湿度が低いと水の蒸発が活発になり、湿球の温度が下がるため、差が大きくなります。"},
                {id: 4, level: "normal", question: "天気図で、同じ気圧の地点を結んだ線を何というか。", options: ["等圧線", "等温線", "等高線", "前線"], answer: 0, explanation: "等圧線は気圧が等しい地点を結んだ線で、天気図で気圧の分布を表します。"},
                {id: 5, level: "advanced", question: "天気図で等圧線の間隔がせまいところでは、風はどのようになっているか。", options: ["強い", "弱い", "無風", "一定"], answer: 0, explanation: "等圧線の間隔がせまいところは気圧の差が大きいため、風が強くなります。"},
            ],
            "2-3-2": [
                {id: 1, level: "basic", question: "空気中の水蒸気が冷やされて水滴になる温度を何というか。", options: ["露点", "沸点", "融点", "凝固点"], answer: 0, explanation: "露点は空気中の水蒸気が水滴になり始める温度です。"},
                {id: 2, level: "basic", question: "暖かい空気と冷たい空気の境目を何というか。", options: ["前線", "等圧線", "等温線", "気団"], answer: 0, explanation: "前線は性質の異なる気団（空気のかたまり）の境目です。"},
                {id: 3, level: "normal", question: "寒冷前線が通過するときの天気の変化として正しいものはどれか。", options: ["短時間に強い雨が降り、気温が急に下がる", "おだやかな雨が長く続く", "晴れて気温が上がる", "霧が発生する"], answer: 0, explanation: "寒冷前線では冷たい空気が暖かい空気の下にもぐり込み、急激な上昇気流で短時間の強い雨が降ります。"},
                {id: 4, level: "normal", question: "空気が上昇すると温度が下がる理由として正しいものはどれか。", options: ["気圧が下がり、空気が膨張するから", "太陽から遠くなるから", "酸素が減るから", "水蒸気が減るから"], answer: 0, explanation: "上空は気圧が低いため空気が膨張し、膨張するときにエネルギーを使うので温度が下がります。"},
                {id: 5, level: "advanced", question: "温暖前線と寒冷前線が重なってできる前線を何というか。また、この前線ができると低気圧はどうなるか。", options: ["閉塞前線。低気圧は弱まる", "停滞前線。低気圧は強まる", "閉塞前線。低気圧は強まる", "停滞前線。低気圧は弱まる"], answer: 0, explanation: "閉塞前線ができると暖気が地表から切り離され、低気圧のエネルギー源がなくなり弱まります。"},
            ],
            "2-3-3": [
                {id: 1, level: "basic", question: "日本付近で、西から東へ移動する高気圧を何というか。", options: ["移動性高気圧", "シベリア高気圧", "小笠原高気圧", "オホーツク海高気圧"], answer: 0, explanation: "移動性高気圧は偏西風に乗って西から東へ移動し、天気を周期的に変化させます。"},
                {id: 2, level: "basic", question: "夏に日本の南東に発達し、むし暑い天気をもたらす高気圧を何というか。", options: ["小笠原高気圧（太平洋高気圧）", "シベリア高気圧", "オホーツク海高気圧", "移動性高気圧"], answer: 0, explanation: "小笠原高気圧は夏に発達し、日本に暖かく湿った空気を送り込みます。"},
                {id: 3, level: "normal", question: "冬に日本海側で雪が多い理由として正しいものはどれか。", options: ["シベリアからの冷たい空気が日本海で水蒸気を含み、山にぶつかるから", "太平洋からの暖かい空気が流れ込むから", "台風が多く通過するから", "偏西風が強いから"], answer: 0, explanation: "シベリア高気圧からの冷たい空気が日本海で水蒸気を含み、山脈にぶつかって上昇し雪を降らせます。"},
                {id: 4, level: "normal", question: "梅雨の時期に見られる、日本付近に停滞する前線を何というか。", options: ["梅雨前線", "寒冷前線", "温暖前線", "閉塞前線"], answer: 0, explanation: "梅雨前線は小笠原気団とオホーツク海気団の境目にできる停滞前線です。"},
                {id: 5, level: "advanced", question: "「西高東低」の気圧配置は、どの季節に典型的に見られるか。また、このとき日本ではどのような風が吹くか。", options: ["冬。北西の季節風", "夏。南東の季節風", "春。偏西風", "秋。北東の風"], answer: 0, explanation: "冬は西にシベリア高気圧、東に低気圧があり、北西の冷たい季節風が吹きます。"},
            ],
            "2-4-1": [
                {id: 1, level: "basic", question: "異なる物質をこすり合わせると発生する電気を何というか。", options: ["静電気", "電流", "電圧", "電力"], answer: 0, explanation: "静電気は摩擦によって発生する電気で、物体にたまった状態の電気です。"},
                {id: 2, level: "basic", question: "電気の流れを何というか。", options: ["電流", "電圧", "抵抗", "静電気"], answer: 0, explanation: "電流は電気の流れのことで、単位はA（アンペア）です。"},
                {id: 3, level: "normal", question: "+の電気を帯びた物体と−の電気を帯びた物体を近づけると、どうなるか。", options: ["引き合う", "しりぞけ合う", "何も起こらない", "電気が消える"], answer: 0, explanation: "異なる種類の電気は引き合い、同じ種類の電気はしりぞけ合います。"},
                {id: 4, level: "normal", question: "静電気が流れると電流になる。このことを確かめる実験として適切なものはどれか。", options: ["蛍光灯に静電気を近づけると一瞬光る", "磁石を近づけると静電気が発生する", "水に静電気を通すと分解する", "静電気を熱すると電流になる"], answer: 0, explanation: "静電気が流れる（放電する）と電流が生じ、蛍光灯の中の気体を一瞬光らせます。"},
                {id: 5, level: "advanced", question: "真空放電管に高い電圧をかけると、陰極から直進する線が出る。この線を何というか。", options: ["陰極線（電子の流れ）", "陽極線", "X線", "光線"], answer: 0, explanation: "陰極線は電子の流れで、電子が−の電気を持つことの発見につながりました。"},
            ],
            "2-4-2": [
                {id: 1, level: "basic", question: "電流の単位は何か。", options: ["A（アンペア）", "V（ボルト）", "Ω（オーム）", "W（ワット）"], answer: 0, explanation: "電流の単位はA（アンペア）です。電圧はV、抵抗はΩです。"},
                {id: 2, level: "basic", question: "電流を流そうとする圧力にあたるものを何というか。", options: ["電圧", "電流", "抵抗", "電力"], answer: 0, explanation: "電圧は電流を流そうとする圧力で、単位はV（ボルト）です。"},
                {id: 3, level: "normal", question: "直列回路では、各部分を流れる電流の大きさはどうなるか。", options: ["どこでも同じ", "電源に近いほど大きい", "抵抗の大きいところで大きい", "電源から遠いほど大きい"], answer: 0, explanation: "直列回路では、回路のどの部分でも電流の大きさは同じです。"},
                {id: 4, level: "normal", question: "オームの法則を表す式として正しいものはどれか。", options: ["電圧＝電流×抵抗", "電流＝電圧×抵抗", "抵抗＝電流×電圧", "電圧＝抵抗÷電流"], answer: 0, explanation: "オームの法則はV＝I×R（電圧＝電流×抵抗）で表されます。"},
                {id: 5, level: "advanced", question: "10Ωの抵抗に5Vの電圧をかけたとき、流れる電流は何Aか。", options: ["0.5A", "2A", "50A", "15A"], answer: 0, explanation: "オームの法則より、I＝V÷R＝5V÷10Ω＝0.5Aです。"},
            ],
            "2-4-3": [
                {id: 1, level: "basic", question: "磁石のまわりにできる、磁力がはたらく空間を何というか。", options: ["磁界（磁場）", "電界", "重力場", "電流"], answer: 0, explanation: "磁界は磁石のまわりにできる、磁力がはたらく空間です。"},
                {id: 2, level: "basic", question: "コイルに電流を流すと磁界が発生する。このコイルを何というか。", options: ["電磁石", "永久磁石", "方位磁針", "磁気テープ"], answer: 0, explanation: "電磁石は電流を流すと磁石になり、電流を止めると磁力がなくなります。"},
                {id: 3, level: "normal", question: "磁界の中で電流が流れている導線には、どのような力がはたらくか。", options: ["導線を動かそうとする力", "導線を熱する力", "導線を曲げる力", "導線を長くする力"], answer: 0, explanation: "磁界の中で電流が流れると、導線を動かそうとする力がはたらきます。モーターの原理です。"},
                {id: 4, level: "normal", question: "コイルの中の磁界が変化すると、コイルに電圧が発生する。この現象を何というか。", options: ["電磁誘導", "静電誘導", "電磁波", "磁化"], answer: 0, explanation: "電磁誘導はコイルの中の磁界が変化すると電圧が発生する現象で、発電機の原理です。"},
                {id: 5, level: "advanced", question: "電磁誘導で発生する電圧を大きくする方法として正しいものはどれか。", options: ["コイルの巻き数を増やす・磁石を速く動かす", "コイルの巻き数を減らす", "磁石をゆっくり動かす", "コイルを小さくする"], answer: 0, explanation: "誘導電圧はコイルの巻き数が多いほど、磁界の変化が速いほど大きくなります。"},
            ],
            "3-1-1": [
                {id: 1, level: "basic", question: "原子が電気を帯びたものを何というか。", options: ["イオン", "分子", "電子", "中性子"], answer: 0, explanation: "イオンは原子が電子を失ったり得たりして電気を帯びた粒子です。"},
                {id: 2, level: "basic", question: "水に溶かすと電流が流れる物質を何というか。", options: ["電解質", "非電解質", "導体", "絶縁体"], answer: 0, explanation: "電解質は水に溶けるとイオンに分かれ、電流が流れるようになる物質です。"},
                {id: 3, level: "normal", question: "原子が電子を失ってできる、+の電気を帯びたイオンを何というか。", options: ["陽イオン", "陰イオン", "原子核", "中性子"], answer: 0, explanation: "陽イオンは原子が電子を失って+の電気を帯びたもの、陰イオンは電子を得て−の電気を帯びたものです。"},
                {id: 4, level: "normal", question: "塩化銅水溶液を電気分解すると、陰極には何が付着するか。", options: ["銅", "塩素", "酸素", "水素"], answer: 0, explanation: "陰極には+の銅イオンが引きつけられ、電子を受け取って銅として付着します。"},
                {id: 5, level: "advanced", question: "塩化ナトリウム（NaCl）が水に溶けるとき、どのようにイオンに分かれるか。", options: ["Na⁺とCl⁻", "Na⁻とCl⁺", "Na²⁺とCl²⁻", "NaとCl"], answer: 0, explanation: "塩化ナトリウムはナトリウムイオン（Na⁺）と塩化物イオン（Cl⁻）に電離します。"},
            ],
            "3-1-2": [
                {id: 1, level: "basic", question: "酸性の水溶液に共通して含まれるイオンは何か。", options: ["水素イオン（H⁺）", "水酸化物イオン（OH⁻）", "塩化物イオン（Cl⁻）", "ナトリウムイオン（Na⁺）"], answer: 0, explanation: "酸性の水溶液には水素イオン（H⁺）が共通して含まれています。"},
                {id: 2, level: "basic", question: "アルカリ性の水溶液に共通して含まれるイオンは何か。", options: ["水酸化物イオン（OH⁻）", "水素イオン（H⁺）", "ナトリウムイオン（Na⁺）", "塩化物イオン（Cl⁻）"], answer: 0, explanation: "アルカリ性の水溶液には水酸化物イオン（OH⁻）が共通して含まれています。"},
                {id: 3, level: "normal", question: "酸とアルカリを混ぜると、たがいの性質を打ち消し合う。この反応を何というか。", options: ["中和", "酸化", "還元", "分解"], answer: 0, explanation: "中和は酸とアルカリが反応して、たがいの性質を打ち消し合う反応です。"},
                {id: 4, level: "normal", question: "中和反応でできる物質は何か。", options: ["水と塩", "酸素と水素", "二酸化炭素と水", "塩素とナトリウム"], answer: 0, explanation: "中和反応ではH⁺とOH⁻が結びついて水ができ、残りのイオンが塩（えん）をつくります。"},
                {id: 5, level: "advanced", question: "塩酸と水酸化ナトリウム水溶液を混ぜたときにできる塩の名前と化学式は何か。", options: ["塩化ナトリウム（NaCl）", "硫酸ナトリウム（Na₂SO₄）", "炭酸ナトリウム（Na₂CO₃）", "硝酸ナトリウム（NaNO₃）"], answer: 0, explanation: "HCl + NaOH → NaCl + H₂O で、塩化ナトリウム（食塩）と水ができます。"},
            ],
            "3-1-3": [
                {id: 1, level: "basic", question: "化学変化によって電気エネルギーを取り出す装置を何というか。", options: ["化学電池", "発電機", "モーター", "電熱器"], answer: 0, explanation: "化学電池は化学変化によって化学エネルギーを電気エネルギーに変換する装置です。"},
                {id: 2, level: "basic", question: "充電して繰り返し使える電池を何というか。", options: ["二次電池（蓄電池）", "一次電池", "燃料電池", "太陽電池"], answer: 0, explanation: "二次電池は充電して繰り返し使え、一次電池は使い切りの電池です。"},
                {id: 3, level: "normal", question: "亜鉛板と銅板を電解質の水溶液に入れると電池ができる。このとき−極になるのはどちらか。", options: ["亜鉛板", "銅板", "どちらも+極", "電解質による"], answer: 0, explanation: "亜鉛は銅よりイオンになりやすいため、電子を放出して−極になります。"},
                {id: 4, level: "normal", question: "水素と酸素を反応させて電気エネルギーを取り出す電池を何というか。", options: ["燃料電池", "乾電池", "太陽電池", "リチウム電池"], answer: 0, explanation: "燃料電池は水素と酸素の反応で電気を取り出し、水ができるクリーンな電池です。"},
                {id: 5, level: "advanced", question: "ダニエル電池で、亜鉛板側の水溶液と銅板側の水溶液を分けている理由として正しいものはどれか。", options: ["−極で起こる反応と+極で起こる反応を分けるため", "見た目をきれいにするため", "温度を一定に保つため", "電流を大きくするため"], answer: 0, explanation: "2つの半電池反応を分けることで、電子が導線を通って流れ、安定した電流が得られます。"},
            ],
            "3-2-1": [
                {id: 1, level: "basic", question: "生物が自分と同じ種類の個体をふやすことを何というか。", options: ["生殖", "成長", "発生", "遺伝"], answer: 0, explanation: "生殖は生物が自分と同じ種類の子をつくり、なかまをふやすことです。"},
                {id: 2, level: "basic", question: "雄と雌の生殖細胞が合体することを何というか。", options: ["受精", "受粉", "発芽", "分裂"], answer: 0, explanation: "受精は精子と卵が合体して受精卵ができることです。"},
                {id: 3, level: "normal", question: "有性生殖と無性生殖の違いとして正しいものはどれか。", options: ["有性生殖は2つの親から、無性生殖は1つの親から子ができる", "有性生殖は植物だけ、無性生殖は動物だけ", "有性生殖は遅く、無性生殖は速い", "有性生殖は小さな子、無性生殖は大きな子ができる"], answer: 0, explanation: "有性生殖は2つの親の遺伝子が混ざり、無性生殖は親と同じ遺伝子を持つ子ができます。"},
                {id: 4, level: "normal", question: "ジャガイモが塊茎（いも）でふえるのは、有性生殖と無性生殖のどちらか。", options: ["無性生殖", "有性生殖", "両方", "どちらでもない"], answer: 0, explanation: "塊茎でふえる（栄養生殖）は1つの親からふえる無性生殖で、親と同じ遺伝子を持ちます。"},
                {id: 5, level: "advanced", question: "有性生殖の利点として最も適切なものはどれか。", options: ["遺伝子の組み合わせが多様になり、環境変化に適応しやすい", "子孫を速くふやせる", "親と同じ性質の子ができる", "エネルギーが少なくてすむ"], answer: 0, explanation: "有性生殖では遺伝子が混ざり、多様な個体ができるため環境変化への適応力が高まります。"},
            ],
            "3-2-2": [
                {id: 1, level: "basic", question: "細胞が2つに分かれてふえることを何というか。", options: ["細胞分裂", "受精", "発生", "成長"], answer: 0, explanation: "細胞分裂は1つの細胞が2つに分かれることで、生物の成長の基本です。"},
                {id: 2, level: "basic", question: "細胞の核の中にある、遺伝情報を持つひも状のものを何というか。", options: ["染色体", "細胞質", "細胞膜", "葉緑体"], answer: 0, explanation: "染色体はDNAを含むひも状の構造で、遺伝情報を持っています。"},
                {id: 3, level: "normal", question: "体細胞分裂で、分裂後の細胞の染色体の数はどうなるか。", options: ["分裂前と同じ", "分裂前の半分", "分裂前の2倍", "不規則に変化する"], answer: 0, explanation: "体細胞分裂では染色体が複製されてから分裂するので、染色体の数は変わりません。"},
                {id: 4, level: "normal", question: "生殖細胞をつくるときの細胞分裂を何というか。", options: ["減数分裂", "体細胞分裂", "有糸分裂", "増殖分裂"], answer: 0, explanation: "減数分裂は染色体の数が半分になる分裂で、精子や卵などの生殖細胞をつくります。"},
                {id: 5, level: "advanced", question: "ヒトの体細胞の染色体は46本だが、精子や卵の染色体は何本か。", options: ["23本", "46本", "92本", "12本"], answer: 0, explanation: "減数分裂で染色体が半分になるので23本です。受精で46本に戻ります。"},
            ],
            "3-2-3": [
                {id: 1, level: "basic", question: "親の形質が子に伝わることを何というか。", options: ["遺伝", "進化", "突然変異", "適応"], answer: 0, explanation: "遺伝は親の形質（特徴）が子に伝わる現象です。"},
                {id: 2, level: "basic", question: "遺伝子の本体である物質を何というか。", options: ["DNA", "RNA", "タンパク質", "酵素"], answer: 0, explanation: "DNAは遺伝情報を持つ物質で、染色体の主成分です。"},
                {id: 3, level: "normal", question: "メンデルの法則で、対になっている遺伝子が分かれて別々の生殖細胞に入る法則を何というか。", options: ["分離の法則", "優性の法則", "独立の法則", "倍数の法則"], answer: 0, explanation: "分離の法則は、対になっている遺伝子が減数分裂で分かれて別々の生殖細胞に入る法則です。"},
                {id: 4, level: "normal", question: "丸い種子の純系（AA）としわの種子の純系（aa）をかけ合わせると、子の遺伝子型はどうなるか。", options: ["すべてAa", "すべてAA", "AAとaaが1:1", "AA:Aa:aa=1:2:1"], answer: 0, explanation: "それぞれの親からAとaを1つずつ受け継ぐので、子の遺伝子型はすべてAaになります。"},
                {id: 5, level: "advanced", question: "Aaどうしをかけ合わせたとき、子の遺伝子型の比はどうなるか。", options: ["AA:Aa:aa=1:2:1", "AA:aa=1:1", "すべてAa", "AA:Aa:aa=1:1:1"], answer: 0, explanation: "Aa×Aaでは、AA:Aa:aa=1:2:1の比で子ができます（表現型は3:1）。"},
            ],
            "3-3-1": [
                {id: 1, level: "basic", question: "一定時間に移動した距離を何というか。", options: ["速さ", "加速度", "距離", "時間"], answer: 0, explanation: "速さは一定時間に移動した距離で、速さ＝距離÷時間で求められます。"},
                {id: 2, level: "basic", question: "速さと向きの両方を表すものを何というか。", options: ["速度", "速さ", "加速度", "距離"], answer: 0, explanation: "速度は速さと向きの両方を含む量で、速さは大きさだけを表します。"},
                {id: 3, level: "normal", question: "速さが一定で変わらない運動を何というか。", options: ["等速直線運動", "等加速度運動", "自由落下", "円運動"], answer: 0, explanation: "等速直線運動は速さが一定で、まっすぐ進む運動です。"},
                {id: 4, level: "normal", question: "時間とともに速さが一定の割合で変化する運動を何というか。", options: ["等加速度運動", "等速直線運動", "振動", "回転運動"], answer: 0, explanation: "等加速度運動は加速度が一定の運動で、自由落下などが例です。"},
                {id: 5, level: "advanced", question: "斜面を下る台車の記録テープで、打点の間隔が一定の割合で広がっていた。この運動について正しいのはどれか。", options: ["速さが一定の割合で増加している", "速さが一定である", "速さが一定の割合で減少している", "速さが不規則に変化している"], answer: 0, explanation: "打点の間隔が一定の割合で広がるのは、速さが一定の割合で増加する等加速度運動です。"},
            ],
            "3-3-2": [
                {id: 1, level: "basic", question: "2つ以上の力を1つの力に置きかえることを何というか。", options: ["力の合成", "力の分解", "力のつり合い", "作用・反作用"], answer: 0, explanation: "力の合成は2つ以上の力を1つの力（合力）に置きかえることです。"},
                {id: 2, level: "basic", question: "1つの力を2つ以上の力に分けることを何というか。", options: ["力の分解", "力の合成", "力のつり合い", "反作用"], answer: 0, explanation: "力の分解は1つの力を2つ以上の力（分力）に分けることです。"},
                {id: 3, level: "normal", question: "同一直線上で同じ向きの2力の合力は、2力の大きさをどうしたものか。", options: ["足したもの", "引いたもの", "かけたもの", "割ったもの"], answer: 0, explanation: "同じ向きの力は足し合わせ、反対向きの力は引き算します。"},
                {id: 4, level: "normal", question: "物体に力がはたらいても動かないとき、物体にはたらく力の合力はどうなっているか。", options: ["0（つり合っている）", "最大", "最小", "一定でない"], answer: 0, explanation: "物体が動かないとき、はたらく力がつり合って合力が0になっています。"},
                {id: 5, level: "advanced", question: "角度をなす2力の合力を求めるときに使う方法は何か。", options: ["平行四辺形の法則", "三平方の定理", "テコの原理", "作用反作用の法則"], answer: 0, explanation: "平行四辺形の法則では、2力を2辺とする平行四辺形の対角線が合力になります。"},
            ],
            "3-3-3": [
                {id: 1, level: "basic", question: "仕事の単位は何か。", options: ["J（ジュール）", "N（ニュートン）", "W（ワット）", "Pa（パスカル）"], answer: 0, explanation: "仕事の単位はJ（ジュール）で、仕事＝力×距離で求められます。"},
                {id: 2, level: "basic", question: "運動している物体が持つエネルギーを何というか。", options: ["運動エネルギー", "位置エネルギー", "熱エネルギー", "電気エネルギー"], answer: 0, explanation: "運動エネルギーは運動している物体が持つエネルギーです。"},
                {id: 3, level: "normal", question: "高い場所にある物体が持つエネルギーを何というか。", options: ["位置エネルギー", "運動エネルギー", "弾性エネルギー", "化学エネルギー"], answer: 0, explanation: "位置エネルギーは高い場所にある物体が持つエネルギーで、高さに比例します。"},
                {id: 4, level: "normal", question: "運動エネルギーと位置エネルギーの和を何というか。", options: ["力学的エネルギー", "熱エネルギー", "化学エネルギー", "電気エネルギー"], answer: 0, explanation: "力学的エネルギー＝運動エネルギー＋位置エネルギーで、摩擦がなければ一定に保たれます。"},
                {id: 5, level: "advanced", question: "ふりこが最下点を通過するとき、運動エネルギーと位置エネルギーはそれぞれどうなっているか。", options: ["運動エネルギー最大、位置エネルギー最小", "運動エネルギー最小、位置エネルギー最大", "両方とも最大", "両方とも最小"], answer: 0, explanation: "最下点では速さが最大で位置が最も低いため、運動エネルギー最大・位置エネルギー最小です。"},
            ],
            "3-4-1": [
                {id: 1, level: "basic", question: "太陽の表面に見える黒い斑点を何というか。", options: ["黒点", "プロミネンス", "コロナ", "フレア"], answer: 0, explanation: "黒点は太陽表面の温度が周囲より低い部分で、黒く見えます。"},
                {id: 2, level: "basic", question: "太陽のエネルギー源は何か。", options: ["核融合反応", "核分裂反応", "化学反応", "燃焼"], answer: 0, explanation: "太陽では水素がヘリウムに変わる核融合反応でエネルギーを生み出しています。"},
                {id: 3, level: "normal", question: "太陽を観察するときに注意すべきことは何か。", options: ["直接見ない（遮光板や投影法を使う）", "望遠鏡で直接見る", "双眼鏡で見る", "夜に観察する"], answer: 0, explanation: "太陽を直接見ると目を傷めるので、遮光板や投影法を使って観察します。"},
                {id: 4, level: "normal", question: "黒点の観察から、太陽がどのような運動をしていることがわかるか。", options: ["自転している", "公転している", "振動している", "静止している"], answer: 0, explanation: "黒点の位置が日々変化することから、太陽が自転していることがわかります。"},
                {id: 5, level: "advanced", question: "太陽の表面温度は約何度か。", options: ["約6000℃", "約100℃", "約1000℃", "約100万℃"], answer: 0, explanation: "太陽の表面温度は約6000℃で、中心部は約1500万℃にもなります。"},
            ],
            "3-4-2": [
                {id: 1, level: "basic", question: "地球が自分自身の軸を中心に回転することを何というか。", options: ["自転", "公転", "回転", "振動"], answer: 0, explanation: "自転は地球が地軸を中心に1日で1回転する運動です。"},
                {id: 2, level: "basic", question: "地球が太陽のまわりを1年で1周する運動を何というか。", options: ["公転", "自転", "回転", "周回"], answer: 0, explanation: "公転は地球が太陽のまわりを約365日で1周する運動です。"},
                {id: 3, level: "normal", question: "日本で季節が変わる主な原因は何か。", options: ["地軸が傾いているから", "地球と太陽の距離が変わるから", "太陽の温度が変わるから", "月の影響"], answer: 0, explanation: "地軸が約23.4°傾いているため、季節によって日光の当たり方が変わります。"},
                {id: 4, level: "normal", question: "星が1時間に約15°東から西へ動いて見える理由は何か。", options: ["地球が西から東へ自転しているから", "星が実際に動いているから", "地球が公転しているから", "大気の影響"], answer: 0, explanation: "地球が西から東へ自転するため、星は見かけ上、東から西へ動いて見えます（日周運動）。"},
                {id: 5, level: "advanced", question: "同じ時刻に見える星座の位置が1か月で約30°西へずれる理由は何か。", options: ["地球が公転しているから", "地球が自転しているから", "星が移動しているから", "季節が変わるから"], answer: 0, explanation: "地球が公転して太陽のまわりを移動するため、見える星座の方向が変わります（年周運動）。"},
            ],
            "3-4-3": [
                {id: 1, level: "basic", question: "月が満ち欠けするのはなぜか。", options: ["太陽に照らされる部分の見え方が変わるから", "月自体が変形するから", "雲がかかるから", "地球の影が映るから"], answer: 0, explanation: "月は太陽の光を反射して光り、地球から見える部分が変わることで満ち欠けします。"},
                {id: 2, level: "basic", question: "月が地球のまわりを1周するのにかかる時間は約何日か。", options: ["約27日", "約365日", "約7日", "約1日"], answer: 0, explanation: "月は約27日で地球のまわりを1周します（公転周期）。"},
                {id: 3, level: "normal", question: "金星が「明けの明星」や「宵の明星」と呼ばれる理由は何か。", options: ["地球より内側を公転しているから", "地球より外側を公転しているから", "自ら光っているから", "太陽と同じ速さで動くから"], answer: 0, explanation: "金星は地球より内側を公転するため、太陽から大きく離れず、明け方か夕方にしか見えません。"},
                {id: 4, level: "normal", question: "金星の見かけの大きさと形が変化する理由として正しいものはどれか。", options: ["地球と金星の距離が変わるから", "金星自体が膨張・収縮するから", "地球の大気の影響", "金星の自転の影響"], answer: 0, explanation: "地球と金星の距離が変わることで大きさが変わり、太陽光の当たり方で形が変わります。"},
                {id: 5, level: "advanced", question: "月食と日食の違いとして正しいものはどれか。", options: ["月食は地球の影に月が入る、日食は月が太陽を隠す", "月食は月が太陽を隠す、日食は地球の影に月が入る", "月食も日食も地球の影の影響", "月食も日食も月の影の影響"], answer: 0, explanation: "月食は地球の影に月が入る現象、日食は月が太陽を隠す現象です。"},
            ],
            "3-4-4": [
                {id: 1, level: "basic", question: "太陽のまわりを公転している天体で、地球のような天体を何というか。", options: ["惑星", "恒星", "衛星", "小惑星"], answer: 0, explanation: "惑星は太陽のまわりを公転する大きな天体で、太陽系には8つあります。"},
                {id: 2, level: "basic", question: "自ら光を出している星を何というか。", options: ["恒星", "惑星", "衛星", "彗星"], answer: 0, explanation: "恒星は太陽のように自ら光を出している星です。"},
                {id: 3, level: "normal", question: "太陽系の惑星を太陽に近い順に並べたとき、3番目は何か。", options: ["地球", "金星", "火星", "水星"], answer: 0, explanation: "太陽に近い順は、水星・金星・地球・火星・木星・土星・天王星・海王星です。"},
                {id: 4, level: "normal", question: "木星や土星のように、主にガスでできている惑星を何というか。", options: ["巨大ガス惑星", "地球型惑星", "小惑星", "準惑星"], answer: 0, explanation: "木星・土星は主に水素やヘリウムでできた巨大ガス惑星です。"},
                {id: 5, level: "advanced", question: "太陽系が属する、約2000億個の恒星からなる天体の集団を何というか。", options: ["銀河系（天の川銀河）", "太陽系", "星雲", "星団"], answer: 0, explanation: "太陽系は銀河系（天の川銀河）に属しており、銀河系は約2000億個の恒星からなります。"},
            ],
            "3-5-1": [
                {id: 1, level: "basic", question: "生態系で、光合成によって有機物をつくる生物を何というか。", options: ["生産者", "消費者", "分解者", "捕食者"], answer: 0, explanation: "生産者は光合成で無機物から有機物をつくる生物（主に植物）です。"},
                {id: 2, level: "basic", question: "生態系で、有機物を無機物に分解する生物を何というか。", options: ["分解者", "生産者", "消費者", "生産者"], answer: 0, explanation: "分解者は落ち葉や動物の死骸などを分解する菌類や細菌類です。"},
                {id: 3, level: "normal", question: "食べる・食べられるの関係でつながった生物の連なりを何というか。", options: ["食物連鎖", "食物網", "生態系", "生物群集"], answer: 0, explanation: "食物連鎖は生産者→消費者という食べる・食べられるの関係のつながりです。"},
                {id: 4, level: "normal", question: "生態系の炭素の循環において、呼吸で放出されるものは何か。", options: ["二酸化炭素", "酸素", "窒素", "水素"], answer: 0, explanation: "生物の呼吸では有機物が分解され、二酸化炭素が放出されます。"},
                {id: 5, level: "advanced", question: "生態系で、ある生物が絶滅すると他の生物にも影響が及ぶ理由として最も適切なものはどれか。", options: ["食物連鎖でつながっているから", "同じ場所にいるから", "見た目が似ているから", "同じ時期に生まれるから"], answer: 0, explanation: "生物は食物連鎖でつながっているため、1種の絶滅が他の生物に影響を及ぼします。"},
            ],
            "3-5-2": [
                {id: 1, level: "basic", question: "身近な自然環境を調べることを何というか。", options: ["自然環境の調査", "気象観測", "天体観測", "地質調査"], answer: 0, explanation: "自然環境の調査では、水質や生物の分布などを調べます。"},
                {id: 2, level: "basic", question: "人間の活動によって自然環境が悪化することを何というか。", options: ["環境問題", "自然災害", "気候変動", "生態系"], answer: 0, explanation: "環境問題は人間活動による大気汚染、水質汚濁、森林破壊などの問題です。"},
                {id: 3, level: "normal", question: "水質を調べる指標生物として、きれいな水に住む生物はどれか。", options: ["サワガニ、カワゲラの幼虫", "ミズムシ、セスジユスリカの幼虫", "イトミミズ、チョウバエの幼虫", "どれも同じ"], answer: 0, explanation: "サワガニやカワゲラの幼虫はきれいな水に住み、水質の指標生物として使われます。"},
                {id: 4, level: "normal", question: "生物の多様性を守ることが大切な理由として最も適切なものはどれか。", options: ["生態系のバランスを保つため", "見た目がきれいだから", "数を増やすため", "人間に害があるから"], answer: 0, explanation: "生物多様性は生態系のバランスを保ち、人間を含む生物の生存基盤となっています。"},
                {id: 5, level: "advanced", question: "外来種が在来種に与える影響として最も深刻なものはどれか。", options: ["生態系のバランスが崩れ、在来種が絶滅する恐れがある", "見た目が変わる", "音がうるさくなる", "気温が変化する"], answer: 0, explanation: "外来種は在来種と競争したり捕食したりして、生態系のバランスを崩す恐れがあります。"},
            ],
            "3-5-3": [
                {id: 1, level: "basic", question: "石油や石炭など、大昔の生物の遺骸からできた燃料を何というか。", options: ["化石燃料", "バイオ燃料", "核燃料", "太陽光"], answer: 0, explanation: "化石燃料は大昔の生物の遺骸が変化してできた燃料で、限りある資源です。"},
                {id: 2, level: "basic", question: "太陽光や風力など、くり返し使えるエネルギーを何というか。", options: ["再生可能エネルギー", "化石エネルギー", "核エネルギー", "地熱エネルギー"], answer: 0, explanation: "再生可能エネルギーは自然界で繰り返し得られるエネルギーです。"},
                {id: 3, level: "normal", question: "化石燃料を燃やすと増加し、地球温暖化の原因となる気体は何か。", options: ["二酸化炭素", "酸素", "窒素", "水素"], answer: 0, explanation: "化石燃料の燃焼で二酸化炭素が増加し、温室効果で地球温暖化の原因となります。"},
                {id: 4, level: "normal", question: "プラスチックの問題点として正しいものはどれか。", options: ["自然界で分解されにくく、環境汚染の原因になる", "すぐに分解されて使えなくなる", "作るのにエネルギーがかからない", "リサイクルできない"], answer: 0, explanation: "プラスチックは分解されにくく、海洋汚染などの環境問題を引き起こしています。"},
                {id: 5, level: "advanced", question: "持続可能な社会を実現するために大切な考え方として適切なものはどれか。", options: ["3R（リデュース、リユース、リサイクル）", "大量生産・大量消費", "使い捨て", "輸入に頼る"], answer: 0, explanation: "3R（減らす・再使用・再資源化）は持続可能な社会のための重要な考え方です。"},
            ],
            "3-5-4": [
                {id: 1, level: "basic", question: "地震や火山噴火、台風などによる災害を何というか。", options: ["自然災害", "人災", "公害", "事故"], answer: 0, explanation: "自然災害は地震、津波、火山噴火、台風、洪水などの自然現象による災害です。"},
                {id: 2, level: "basic", question: "地震のゆれに備えて、家具を固定するなどの対策を何というか。", options: ["防災対策", "復興対策", "開発対策", "生産対策"], answer: 0, explanation: "防災対策は災害の被害を減らすために事前に行う対策です。"},
                {id: 3, level: "normal", question: "ハザードマップで示されているものは何か。", options: ["災害による被害が予測される範囲や避難場所", "観光スポット", "商業施設の場所", "交通量"], answer: 0, explanation: "ハザードマップは洪水や土砂災害などの被害予測範囲や避難場所を示した地図です。"},
                {id: 4, level: "normal", question: "津波から身を守るために最も大切なことは何か。", options: ["高い場所にすぐに避難する", "海の様子を見に行く", "家に戻って荷物を取る", "低い場所で待機する"], answer: 0, explanation: "津波警報が出たらすぐに高い場所に避難することが命を守る最優先の行動です。"},
                {id: 5, level: "advanced", question: "日本で自然災害が多い理由として正しいものはどれか。", options: ["プレートの境界に位置し、台風の通り道でもあるから", "面積が大きいから", "人口が多いから", "海に囲まれているから"], answer: 0, explanation: "日本は複数のプレートの境界に位置し、台風の通り道でもあるため、災害が多いです。"},
            ],
            "3-5-5": [
                {id: 1, level: "basic", question: "将来の世代のニーズを満たしつつ、現在の世代のニーズも満たす社会を何というか。", options: ["持続可能な社会", "消費社会", "情報社会", "工業社会"], answer: 0, explanation: "持続可能な社会は、環境を守りながら発展を続けられる社会です。"},
                {id: 2, level: "basic", question: "環境に配慮した製品を選んで購入することを何というか。", options: ["グリーン購入", "大量消費", "衝動買い", "セール購入"], answer: 0, explanation: "グリーン購入は環境への負荷が少ない製品やサービスを選んで購入することです。"},
                {id: 3, level: "normal", question: "SDGsとは何か。", options: ["持続可能な開発目標", "科学技術の目標", "経済成長の目標", "人口増加の目標"], answer: 0, explanation: "SDGsは2030年までに達成を目指す、17の持続可能な開発目標です。"},
                {id: 4, level: "normal", question: "科学技術の発展と環境保全の関係として正しいものはどれか。", options: ["科学技術は環境問題の解決にも貢献できる", "科学技術は環境を悪化させるだけ", "環境保全と科学技術は無関係", "環境保全のために科学技術は不要"], answer: 0, explanation: "科学技術は環境問題の原因にもなりますが、解決のための手段にもなります。"},
                {id: 5, level: "advanced", question: "持続可能な社会を実現するために、私たちができることとして最も適切なものはどれか。", options: ["科学的な視点で問題を理解し、日常生活で行動する", "すべて専門家に任せる", "経済成長だけを優先する", "何もしない"], answer: 0, explanation: "持続可能な社会は、一人一人が問題を理解し、日常生活で行動することで実現できます。"},
            ],
        };

        // カリキュラムデータ（教科書LOD + 学習指導要領LODより生成）
        // データソース: https://jp-textbook.github.io/ / https://jp-cos.github.io/
        const curriculumData = {
            metadata: {
                title: "りかナビ",
                subtitle: "中学理科学習ナビゲーター",
                textbook: "新しい科学（東京書籍）2020年検定",
                dataSource: "教科書LOD (https://jp-textbook.github.io/)",
                dataDate: "2025-08-06"
            },
            domains: [
                { id: "energy", name: "エネルギー", color: "#FF6B6B", icon: "⚡" },
                { id: "particle", name: "粒子", color: "#4ECDC4", icon: "🔬" },
                { id: "life", name: "生命", color: "#45B7D1", icon: "🌱" },
                { id: "earth", name: "地球", color: "#96CEB4", icon: "🌍" },
            ],
            grades: {
                "1": {
                    units: [
                        {
                            id: "1-1", unitNumber: 1, title: "単元1　いろいろな生物とその共通点", domain: "life",
                            chapters: [
                                {id: "1-1-1", title: "第1章　生物の観察と分類のしかた", lodUri: "https://w3id.org/jp-textbook/AA100000019106", cosCode: "https://w3id.org/jp-cos/8362213111000000", cosDescription: "生物の観察と分類の仕方", pages: "P.13～26"},
                                {id: "1-1-2", title: "第2章　植物の分類", lodUri: "https://w3id.org/jp-textbook/AA100000019107", cosCode: "https://w3id.org/jp-cos/8362213112100000", cosDescription: "植物の体の共通点と相違点\n✅ 身近な植物の体を観察し、似ている部分や違う部分を探す\n✅ 植物の体の基本的なつくりがわかる\n✅ 植物をグループ分け（分類）できるようになる", pages: "P.27～44"},
                                {id: "1-1-3", title: "第3章　動物の分類", lodUri: "https://w3id.org/jp-textbook/AA100000019108", cosCode: "https://w3id.org/jp-cos/8362213112200000", cosDescription: "動物の体の共通点と相違点\n✅ 身近な動物の体を観察し、似ている部分や違う部分を探す\n✅ 動物の体の基本的なつくりがわかる\n✅ 動物をグループ分け（分類）できるようになる", pages: "P.45～61"},
                            ]
                        },
                        {
                            id: "1-2", unitNumber: 2, title: "単元2　身のまわりの物質", domain: "particle",
                            chapters: [
                                {id: "1-2-1", title: "第1章　身のまわりの物質とその性質", lodUri: "https://w3id.org/jp-textbook/AA100000019110", cosCode: "https://w3id.org/jp-cos/8361213211100000", cosDescription: "身の回りの物質とその性質\n✅ いろいろな物質の性質を実験で調べる\n✅ 物質には「密度」や「加熱したときの変化」など、それぞれ固有の性質があることがわかる\n✅ 実験器具の使い方や記録の取り方を身につける", pages: "P.75～92"},
                                {id: "1-2-2", title: "第2章　気体の性質", lodUri: "https://w3id.org/jp-textbook/AA100000019111", cosCode: "https://w3id.org/jp-cos/8361213211200000", cosDescription: "気体の発生と性質\n✅ 気体を発生させる実験ができる\n✅ 気体の種類によって性質が違うことがわかる\n✅ 気体の集め方（捕集法）を身につける", pages: "P.93～102"},
                                {id: "1-2-3", title: "第3章　水溶液の性質", lodUri: "https://w3id.org/jp-textbook/AA100000019112", cosCode: "https://w3id.org/jp-cos/8361213212000000", cosDescription: "水溶液", pages: "P.103～116"},
                                {id: "1-2-4", title: "第4章　物質の姿と状態変化", lodUri: "https://w3id.org/jp-textbook/AA100000019113", cosCode: "https://w3id.org/jp-cos/8361213213000000", cosDescription: "状態変化", pages: "P.117～133"},
                            ]
                        },
                        {
                            id: "1-3", unitNumber: 3, title: "単元3　身のまわりの現象", domain: "energy",
                            chapters: [
                                {id: "1-3-1", title: "第1章　光の世界", lodUri: "https://w3id.org/jp-textbook/AA100000019115", cosCode: "https://w3id.org/jp-cos/8361213111100000", cosDescription: "光の反射・屈折\n✅ 光の反射や屈折の実験をする\n✅ 光が水やガラスの境目で曲がる規則性を見つける\n✅ 光の進み方のルールを理解する", pages: "P.145～162"},
                                {id: "1-3-2", title: "第2章　音の世界", lodUri: "https://w3id.org/jp-textbook/AA100000019116", cosCode: "https://w3id.org/jp-cos/8361213111300000", cosDescription: "音の性質\n✅ 音についての実験をする\n✅ 音は物が振動することで生まれ、空気中を伝わることがわかる\n✅ 音の高さや大きさは、振動の仕方で決まることを理解する", pages: "P.163～170"},
                            ]
                        },
                        {
                            id: "1-4", unitNumber: 4, title: "単元4　大地の変化", domain: "earth",
                            chapters: [
                                {id: "1-4-1", title: "第3章　力の世界", lodUri: "https://w3id.org/jp-textbook/AA100000019117", cosCode: "https://w3id.org/jp-cos/8361213112000000", cosDescription: "力の働き", pages: "P.171～185"},
                                {id: "1-4-2", title: "第1章　火を吹く大地", lodUri: "https://w3id.org/jp-textbook/AA100000019119", cosCode: "https://w3id.org/jp-cos/8362213213100000", cosDescription: "火山活動と火成岩\n✅ 火山の形や噴火の様子、噴出物を調べる\n✅ 火山の特徴とマグマの性質の関係がわかる\n✅ 火山岩と深成岩の違いと、できかたの関係を理解する", pages: "P.199～212"},
                                {id: "1-4-3", title: "第2章　動き続ける大地", lodUri: "https://w3id.org/jp-textbook/AA100000019120", cosCode: "https://w3id.org/jp-cos/8362213213000000", cosDescription: "火山と地震", pages: "P.213～224"},
                                {id: "1-4-4", title: "第3章　地層から読み取る大地の変化", lodUri: "https://w3id.org/jp-textbook/AA100000019121", cosCode: "https://w3id.org/jp-cos/8362213211000000", cosDescription: "身近な地形や地層，岩石の観察", pages: "P.225～241"},
                            ]
                        },
                    ]
                },
                "2": {
                    units: [
                        {
                            id: "2-1", unitNumber: 1, title: "単元①化学変化と原子・分子", domain: "particle",
                            chapters: [
                                {id: "2-1-1", title: "第1章 物質のなり立ち", lodUri: "https://w3id.org/jp-textbook/AA100000016596", cosCode: "https://w3id.org/jp-cos/8361223411000000", cosDescription: "物質の成り立ち", pages: "P.15-34"},
                                {id: "2-1-2", title: "第2章 物質どうしの化学変化", lodUri: "https://w3id.org/jp-textbook/AA100000016597", cosCode: "https://w3id.org/jp-cos/8361223412100000", cosDescription: "化学変化\n✅ 2種類の物質を反応させる実験をする\n✅ 化学変化で別の物質ができることがわかる\n✅ 原子・分子のモデルで化学変化を説明できる\n✅ 化学式や化学反応式の書き方を理解する", pages: "P.35-48"},
                                {id: "2-1-3", title: "第3章 酸素がかかわる化学変化", lodUri: "https://w3id.org/jp-textbook/AA100000016598", cosCode: "https://w3id.org/jp-cos/8361223412200000", cosDescription: "化学変化における酸化と還元\n✅ 酸化や還元の実験をする\n✅ 酸化は酸素と結びつく反応だとわかる\n✅ 還元は酸素を取り除く反応だとわかる", pages: "P.49-62"},
                                {id: "2-1-4", title: "第4章 化学変化と物質の質量", lodUri: "https://w3id.org/jp-textbook/AA100000016599", cosCode: "https://w3id.org/jp-cos/8361223413000000", cosDescription: "化学変化と物質の質量", pages: "P.63-72"},
                                {id: "2-1-5", title: "第5章 化学変化とその利用", lodUri: "https://w3id.org/jp-textbook/AA100000016600", cosCode: "https://w3id.org/jp-cos/8361223412300000", cosDescription: "化学変化と熱\n✅ 化学変化で熱を取り出す実験をする\n✅ 化学変化には熱が発生したり吸収されたりすることがわかる\n✅ 身近な発熱反応・吸熱反応の例を理解する", pages: "P.73-79"},
                            ]
                        },
                        {
                            id: "2-2", unitNumber: 2, title: "単元②生物のからだのつくりとはたらき", domain: "life",
                            chapters: [
                                {id: "2-2-1", title: "第1章 生物と細胞", lodUri: "https://w3id.org/jp-textbook/AA100000016602", cosCode: "https://w3id.org/jp-cos/8362223311000000", cosDescription: "生物と細胞", pages: "P.91-108"},
                                {id: "2-2-2", title: "第2章 植物のからだのつくりとはたらき", lodUri: "https://w3id.org/jp-textbook/AA100000016603", cosCode: "https://w3id.org/jp-cos/8362223312000000", cosDescription: "植物の体のつくりと働き", pages: "P.109-128"},
                                {id: "2-2-3", title: "第3章 動物のからだのつくりとはたらき", lodUri: "https://w3id.org/jp-textbook/AA100000016604", cosCode: "https://w3id.org/jp-cos/8362223313100000", cosDescription: "生命を維持する働き\n✅ 消化や呼吸についての実験をする\n✅ 体が必要な物質を取り入れて運ぶ仕組みがわかる\n✅ 不要になった物質を体の外に出す仕組みを理解する", pages: "P.129-148"},
                                {id: "2-2-4", title: "第4章 刺激と反応", lodUri: "https://w3id.org/jp-textbook/AA100000016605", cosCode: "https://w3id.org/jp-cos/8362223313200000", cosDescription: "刺激と反応\n✅ 動物が外からの刺激に反応する様子を観察する\n✅ 感覚器官（目・耳など）のつくりがわかる\n✅ 神経と運動器官（筋肉など）の働きを理解する", pages: "P.149-160"},
                            ]
                        },
                        {
                            id: "2-3", unitNumber: 3, title: "単元③天気とその変化", domain: "earth",
                            chapters: [
                                {id: "2-3-1", title: "第1章　気象の観測", lodUri: "https://w3id.org/jp-textbook/AA100000016607", cosCode: "https://w3id.org/jp-cos/8362223411000000", cosDescription: "気象観測", pages: "P.173-196"},
                                {id: "2-3-2", title: "第2章　雲のでき方と前線", lodUri: "https://w3id.org/jp-textbook/AA100000016608", cosCode: "https://w3id.org/jp-cos/8362223412000000", cosDescription: "天気の変化", pages: "P.197-208"},
                                {id: "2-3-3", title: "第3章　大気の動きと日本の天気", lodUri: "https://w3id.org/jp-textbook/AA100000016609", cosCode: "https://w3id.org/jp-cos/8362223413000000", cosDescription: "日本の気象", pages: "P.209-225"},
                            ]
                        },
                        {
                            id: "2-4", unitNumber: 4, title: "単元④電気の世界", domain: "energy",
                            chapters: [
                                {id: "2-4-1", title: "第1章 静電気と電流", lodUri: "https://w3id.org/jp-textbook/AA100000016611", cosCode: "https://w3id.org/jp-cos/8361223311400000", cosDescription: "静電気と電流\n✅ 物をこすり合わせると静電気が起こることを確かめる\n✅ 帯電した物の間には離れていても力が働くことがわかる\n✅ 静電気と電流の関係を理解する", pages: "P.237-248"},
                                {id: "2-4-2", title: "第2章 電流の性質", lodUri: "https://w3id.org/jp-textbook/AA100000016612", cosCode: "https://w3id.org/jp-cos/8361223311100000", cosDescription: "回路と電流・電圧\n✅ 回路をつくり、電流や電圧を測定する\n✅ 回路の各点を流れる電流の規則性を見つける\n✅ 回路の各部分にかかる電圧の規則性を理解する", pages: "P.249-272"},
                                {id: "2-4-3", title: "第3章 電流と磁界", lodUri: "https://w3id.org/jp-textbook/AA100000016613", cosCode: "https://w3id.org/jp-cos/8361223312000000", cosDescription: "電流と磁界", pages: "P.273-289"},
                            ]
                        },
                    ]
                },
                "3": {
                    units: [
                        {
                            id: "3-1", unitNumber: 1, title: "単元 1　化学変化とイオン", domain: "particle",
                            chapters: [
                                {id: "3-1-1", title: "第1 章 水溶液とイオン", lodUri: "https://w3id.org/jp-textbook/AA100000016818", cosCode: "https://w3id.org/jp-cos/8361233611100000", cosDescription: "原子の成り立ちとイオン\n✅ 水溶液に電圧をかけて電流が流れるか調べる\n✅ 電流が流れる水溶液と流れない水溶液があることがわかる\n✅ イオンとは何か、原子の成り立ちと関係づけて理解する", pages: "P.11-28"},
                                {id: "3-1-2", title: "第2 章 酸，アルカリとイオン", lodUri: "https://w3id.org/jp-textbook/AA100000016819", cosCode: "https://w3id.org/jp-cos/8361233611200000", cosDescription: "酸・アルカリ\n✅ 酸とアルカリの性質を調べる実験をする\n✅ 酸の性質は水素イオン（H⁺）によることがわかる\n✅ アルカリの性質は水酸化物イオン（OH⁻）によることがわかる", pages: "P.29-46"},
                                {id: "3-1-3", title: "第3章 化学変化と電池", lodUri: "https://w3id.org/jp-textbook/AA100000016820", cosCode: "https://w3id.org/jp-cos/8361233612000000", cosDescription: "化学変化と電池", pages: "P.47-65"},
                            ]
                        },
                        {
                            id: "3-2", unitNumber: 2, title: "単元 2　生命の連続性", domain: "life",
                            chapters: [
                                {id: "3-2-1", title: "第1章 生物の成長と生殖", lodUri: "https://w3id.org/jp-textbook/AA100000016822", cosCode: "https://w3id.org/jp-cos/8362233511000000", cosDescription: "生物の成長と殖え方", pages: "P.77-94"},
                                {id: "3-2-2", title: "第2章 遺伝の規則性と遺伝子", lodUri: "https://w3id.org/jp-textbook/AA100000016823", cosCode: "https://w3id.org/jp-cos/8362233511100000", cosDescription: "細胞分裂と生物の成長\n✅ 体細胞分裂を観察する\n✅ 細胞分裂の順序を理解する\n✅ 細胞分裂と生物の成長の関係がわかる", pages: "P.95-108"},
                                {id: "3-2-3", title: "第3章 生物の多様性と進化", lodUri: "https://w3id.org/jp-textbook/AA100000016824", cosCode: "https://w3id.org/jp-cos/8362233511100000", cosDescription: "細胞分裂と生物の成長\n✅ 体細胞分裂を観察する\n✅ 細胞分裂の順序を理解する\n✅ 細胞分裂と生物の成長の関係がわかる", pages: "P.109-121"},
                            ]
                        },
                        {
                            id: "3-3", unitNumber: 3, title: "単元    3　運動とエネルギー", domain: "energy",
                            chapters: [
                                {id: "3-3-1", title: "第1章 物体の運動", lodUri: "https://w3id.org/jp-textbook/AA100000016826", cosCode: "https://w3id.org/jp-cos/8361233512000000", cosDescription: "運動の規則性", pages: "P.133-146"},
                                {id: "3-3-2", title: "第2 章 力のはたらき方", lodUri: "https://w3id.org/jp-textbook/AA100000016827", cosCode: "https://w3id.org/jp-cos/8361233511000000", cosDescription: "力のつり合いと合成・分解", pages: "P.147-162"},
                                {id: "3-3-3", title: "第3章 エネルギーと仕事", lodUri: "https://w3id.org/jp-textbook/AA100000016828", cosCode: "https://w3id.org/jp-cos/8361233513000000", cosDescription: "力学的エネルギー", pages: "P.163-183"},
                            ]
                        },
                        {
                            id: "3-4", unitNumber: 4, title: "単元    4　地球と宇宙", domain: "earth",
                            chapters: [
                                {id: "3-4-1", title: "プロローグ 星空をながめよう", lodUri: "https://w3id.org/jp-textbook/AA100000016830", cosCode: "https://w3id.org/jp-cos/8362233612100000", cosDescription: "太陽の様子\n✅ 太陽の観察をする（安全な方法で！）\n✅ 観察記録や資料から太陽の特徴を見つける\n✅ 太陽がどんな天体かを理解する", pages: "P.194-200"},
                                {id: "3-4-2", title: "第1章 地球の運動と天体の動き", lodUri: "https://w3id.org/jp-textbook/AA100000016831", cosCode: "https://w3id.org/jp-cos/8362233611000000", cosDescription: "天体の動きと地球の自転・公転", pages: "P.201-222"},
                                {id: "3-4-3", title: "第2章 月と金星の見え方", lodUri: "https://w3id.org/jp-textbook/AA100000016832", cosCode: "https://w3id.org/jp-cos/8362233612300000", cosDescription: "月や金星の運動と見え方\n✅ 月を観察し、記録をつける\n✅ 月の公転と見え方の関係がわかる\n✅ 金星の公転と見え方の関係を理解する", pages: "P.223-234"},
                                {id: "3-4-4", title: "第3 章 宇宙の広がり", lodUri: "https://w3id.org/jp-textbook/AA100000016833", cosCode: "https://w3id.org/jp-cos/8362233612200000", cosDescription: "惑星と恒星\n✅ 惑星と恒星の違いがわかる\n✅ 太陽系の構造を理解する\n✅ 様々な天体の特徴を資料から読み取る", pages: "P.235-243"},
                            ]
                        },
                        {
                            id: "3-5", unitNumber: 5, title: "単元 5　地球と私たちの未来のために", domain: "earth",
                            chapters: [
                                {id: "3-5-1", title: "第1 章 自然のなかの生物", lodUri: "https://w3id.org/jp-textbook/AA100000016835", cosCode: "https://w3id.org/jp-cos/8362233711100000", cosDescription: "自然界のつり合い\n✅ 微生物の働きを調べる\n✅ 植物・動物・微生物が栄養の面でつながっていることがわかる\n✅ 自然界で生物がバランスを保って生きていることを理解する", pages: "P.255-268"},
                                {id: "3-5-2", title: "第2 章 自然環境の調査と保全", lodUri: "https://w3id.org/jp-textbook/AA100000016836", cosCode: "https://w3id.org/jp-cos/8362233711200000", cosDescription: "自然環境の調査と環境保全\n✅ 身近な自然環境を調べる\n✅ いろいろな要因が自然のバランスに影響していることがわかる\n✅ 自然環境を守ることの大切さを認識する", pages: "P.269-278"},
                                {id: "3-5-3", title: "第3章 科学技術と人間", lodUri: "https://w3id.org/jp-textbook/AA100000016837", cosCode: "https://w3id.org/jp-cos/8361233711000000", cosDescription: "エネルギーと物質", pages: "P.279-296"},
                                {id: "3-5-4", title: "地域とつながる　自然災害と地域のかかわりを学ぶ", lodUri: "https://w3id.org/jp-textbook/AA100000016838", cosCode: "https://w3id.org/jp-cos/8362233711300000", cosDescription: "地域の自然災害\n✅ 地域で起こりうる自然災害について調べる\n✅ 自然と人間の関わり方を考える\n✅ 防災について認識を深める", pages: "P.297-300"},
                                {id: "3-5-5", title: "終章 持続可能な社会をつくるために", lodUri: "https://w3id.org/jp-textbook/AA100000016839", cosCode: "https://w3id.org/jp-cos/8361233712000000", cosDescription: "自然環境の保全と科学技術の利用", pages: "P.301-309"},
                            ]
                        },
                    ]
                },
            }
        };

        // ローカルストレージのキー
        const STORAGE_KEY = 'rikanavi_progress';

        // 進捗データの読み込み
        const loadProgress = () => {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : {};
            } catch {
                return {};
            }
        };

        // 進捗データの保存
        const saveProgress = (progress) => {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        };

        // 進捗リング コンポーネント
        const ProgressRing = ({ percent, size = 60, strokeWidth = 6 }) => {
            const radius = (size - strokeWidth) / 2;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (percent / 100) * circumference;
            
            return (
                <svg width={size} height={size} className="progress-ring">
                    <circle
                        stroke="#e5e7eb"
                        fill="transparent"
                        strokeWidth={strokeWidth}
                        r={radius}
                        cx={size / 2}
                        cy={size / 2}
                    />
                    <circle
                        stroke="#10b981"
                        fill="transparent"
                        strokeWidth={strokeWidth}
                        strokeLinecap="round"
                        r={radius}
                        cx={size / 2}
                        cy={size / 2}
                        style={{
                            strokeDasharray: circumference,
                            strokeDashoffset: offset,
                            transition: 'stroke-dashoffset 0.5s ease'
                        }}
                    />
                    <text
                        x="50%"
                        y="50%"
                        textAnchor="middle"
                        dy=".3em"
                        className="text-sm font-bold"
                        style={{ transform: 'rotate(90deg)', transformOrigin: 'center' }}
                    >
                        {Math.round(percent)}%
                    </text>
                </svg>
            );
        };

        // 章カード コンポーネント
        const ChapterCard = ({ chapter, domain, isCompleted, isCurrent, onToggle, onSelect, showGrade = false, grade = "", quizScore = null }) => {
            const domainColors = {
                energy: 'border-red-400 bg-red-50',
                particle: 'border-teal-400 bg-teal-50',
                life: 'border-blue-400 bg-blue-50',
                earth: 'border-green-400 bg-green-50'
            };

            return (
                <div 
                    className={`p-3 rounded-lg border-2 cursor-pointer transition-all duration-200 ${domainColors[domain]} 
                        ${isCompleted ? 'opacity-100' : 'opacity-70'} 
                        ${isCurrent ? 'ring-2 ring-orange-400 ring-offset-2' : ''}`}
                    onClick={() => onSelect(chapter)}
                >
                    <div className="flex items-center justify-between">
                        <div className="flex-1 min-w-0">
                            {showGrade && <span className="text-xs text-gray-500 block">{grade}年</span>}
                            <div className="flex items-center gap-1.5">
                                <span className="text-sm font-medium truncate">{chapter.title}</span>
                                {quizScore !== null && (
                                    <span className={`text-xs px-1.5 py-0.5 rounded font-bold flex-shrink-0 ${quizScore >= 80 ? 'bg-green-200 text-green-800' : quizScore >= 60 ? 'bg-yellow-200 text-yellow-800' : 'bg-red-200 text-red-800'}`}>
                                        {quizScore}点
                                    </span>
                                )}
                            </div>
                        </div>
                        <button
                            onClick={(e) => { e.stopPropagation(); onToggle(chapter.id); }}
                            className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors flex-shrink-0 ml-2
                                ${isCompleted ? 'bg-green-500 border-green-500 text-white' : 'border-gray-300'}`}
                        >
                            {isCompleted && '✓'}
                        </button>
                    </div>
                </div>
            );
        };

        // NHK API はサーバーサイドプロキシ(/api/nhk)経由で呼び出し
        
        // 再生時間をフォーマット（PT0H2M9S → 2:09）
        const formatDuration = (duration) => {
            if (!duration) return "";
            const match = duration.match(/PT(\d+)H(\d+)M(\d+)S/);
            if (match) {
                const [, h, m, s] = match;
                if (parseInt(h) > 0) {
                    return `${h}:${m.padStart(2, '0')}:${s.padStart(2, '0')}`;
                }
                return `${m}:${s.padStart(2, '0')}`;
            }
            return "";
        };
        
        // 動画検索 コンポーネント（YouTube + NHK for School API + Web検索 + 確認テスト）
        const VideoSearch = ({ chapter, onClose, showQuiz, quizAnswers, quizSubmitted, quizResults, startQuiz, selectAnswer, submitQuiz, closeQuiz }) => {
            const [nhkVideos, setNhkVideos] = React.useState([]);
            const [nhkLoading, setNhkLoading] = React.useState(false);
            const [nhkError, setNhkError] = React.useState(null);
            const [showNhkVideos, setShowNhkVideos] = React.useState(false);
            
            // chapter.idから学年を抽出（例: "1-2-3" → "1"）
            const grade = chapter.id.split('-')[0];
            
            // cosCodeから16桁のコードを抽出（https://w3id.org/jp-cos/8362213111000000 → 8362213111000000）
            const extractCsCode = (cosCodeUrl) => {
                if (!cosCodeUrl) return null;
                const match = cosCodeUrl.match(/(\d{16})$/);
                return match ? match[1] : null;
            };
            
            // NHK for School API呼び出し
            const fetchNhkVideos = async () => {
                const csCode = extractCsCode(chapter.cosCode);
                if (!csCode) {
                    setNhkError("学習指導要領コードが見つかりません");
                    return;
                }
                
                setNhkLoading(true);
                setNhkError(null);
                setShowNhkVideos(true);
                
                try {
                    // サーバーサイドプロキシ経由でNHK APIを呼び出し
                    const url = `/api/nhk?cscode=${csCode}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    setNhkVideos(data.result || []);
                    
                    if (!data.result || data.result.length === 0) {
                        setNhkError("この章に対応する動画が見つかりませんでした");
                    }
                } catch (err) {
                    console.error("NHK API Error:", err);
                    setNhkError("動画の取得に失敗しました");
                } finally {
                    setNhkLoading(false);
                }
            };
            
            // YouTube用：章タイトル + 学年 + 理科
            const youtubeQuery = encodeURIComponent(`${chapter.title} 中学${grade}年 理科`);
            const youtubeUrl = `https://www.youtube.com/results?search_query=${youtubeQuery}`;
            
            // Web検索用：YouTubeと同じ形式
            const webQuery = encodeURIComponent(`${chapter.title} 中学${grade}年 理科`);
            const webUrl = `https://www.google.com/search?q=${webQuery}`;
            
            return (
                <div 
                    className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                    onClick={onClose}
                    style={{overflow: 'hidden'}}
                >
                    <div 
                        className="bg-white rounded-xl max-w-2xl w-full flex flex-col"
                        onClick={(e) => e.stopPropagation()}
                        style={{maxHeight: '90vh'}}
                    >
                        <div className="p-4 border-b flex justify-between items-center" style={{flexShrink: 0}}>
                            <h3 className="text-lg font-bold">{chapter.title}</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                        <div className="p-6 space-y-4" style={{overflowY: 'auto', flex: 1}}>
                            {/* この章で学ぶこと */}
                            {chapter.cosDescription && (
                                <div className="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <p className="text-sm font-bold text-yellow-800 mb-2">📖 この章の学習目標</p>
                                    <p className="text-sm text-yellow-900 whitespace-pre-line">{chapter.cosDescription}</p>
                                </div>
                            )}
                            
                            <p className="text-gray-600">
                                学習する方法を選ぼう！
                            </p>
                            
                            {/* NHK for School */}
                            {!showNhkVideos ? (
                                <button
                                    onClick={fetchNhkVideos}
                                    className="block w-full py-4 px-4 bg-gradient-to-r from-green-500 to-green-600 text-white text-center rounded-lg hover:from-green-600 hover:to-green-700 transition-all shadow-md"
                                >
                                    <div className="flex items-center justify-center gap-2">
                                        <span className="text-xl">📚</span>
                                        <span className="font-bold">NHK for School の動画を見る</span>
                                    </div>
                                    <p className="text-sm text-green-100 mt-1">NHKが学校の勉強用につくった動画</p>
                                </button>
                            ) : (
                                <div className="border border-green-200 rounded-lg overflow-hidden">
                                    <div className="bg-green-500 text-white p-3 flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <span>📚</span>
                                            <span className="font-bold">NHK for School</span>
                                        </div>
                                        <button 
                                            onClick={() => setShowNhkVideos(false)}
                                            className="text-green-100 hover:text-white text-sm"
                                        >
                                            閉じる
                                        </button>
                                    </div>
                                    <div className="p-3 bg-green-50">
                                        {nhkLoading && (
                                            <div className="text-center py-4">
                                                <div className="inline-block animate-spin rounded-full h-6 w-6 border-2 border-green-500 border-t-transparent"></div>
                                                <p className="text-sm text-green-600 mt-2">動画を検索中...</p>
                                            </div>
                                        )}
                                        {nhkError && (
                                            <p className="text-center text-orange-600 py-2">{nhkError}</p>
                                        )}
                                        {!nhkLoading && nhkVideos.length > 0 && (
                                            <div className="space-y-2 max-h-64 overflow-y-auto">
                                                {nhkVideos.map((video) => (
                                                    <a
                                                        key={video.id}
                                                        href={video.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        className="flex gap-3 p-2 bg-white rounded-lg hover:bg-green-100 transition-colors"
                                                    >
                                                        <img 
                                                            src={video.thumbnailUrl} 
                                                            alt={video.name}
                                                            className="w-24 h-16 object-cover rounded flex-shrink-0"
                                                            onError={(e) => e.target.style.display = 'none'}
                                                        />
                                                        <div className="flex-1 min-w-0">
                                                            <p className="text-sm font-medium text-gray-800 line-clamp-2">{video.name}</p>
                                                            <div className="flex items-center gap-2 mt-1">
                                                                <span className="text-xs text-green-600 bg-green-100 px-1.5 py-0.5 rounded">{video.contentType}</span>
                                                                {video.duration && (
                                                                    <span className="text-xs text-gray-500">{formatDuration(video.duration)}</span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </a>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                            
                            {/* YouTube */}
                            <a
                                href={youtubeUrl}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="block w-full py-4 px-4 bg-gradient-to-r from-red-500 to-red-600 text-white text-center rounded-lg hover:from-red-600 hover:to-red-700 transition-all shadow-md"
                            >
                                <div className="flex items-center justify-center gap-2">
                                    <span className="text-xl">▶️</span>
                                    <span className="font-bold">YouTube で検索</span>
                                </div>
                                <p className="text-sm text-red-100 mt-1">自分にとってわかりやすい動画を探してみよう！</p>
                            </a>
                            
                            {/* Web検索 */}
                            <a
                                href={webUrl}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="block w-full py-4 px-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-center rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all shadow-md"
                            >
                                <div className="flex items-center justify-center gap-2">
                                    <span className="text-xl">🔍</span>
                                    <span className="font-bold">Web で検索</span>
                                </div>
                                <p className="text-sm text-blue-100 mt-1">ふつうにインターネット検索する</p>
                            </a>
                            {/* 確認テスト */}
                            {!showQuiz ? (
                                <button
                                    onClick={startQuiz}
                                    className="block w-full py-4 px-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white text-center rounded-lg hover:from-purple-600 hover:to-purple-700 transition-all shadow-md"
                                >
                                    <div className="flex items-center justify-center gap-2">
                                        <span className="text-xl">📝</span>
                                        <span className="font-bold">確認テストに挑戦</span>
                                        {quizResults[chapter.id] && (
                                            <span className="bg-white text-purple-600 px-2 py-1 rounded text-sm font-bold">
                                                前回 {quizResults[chapter.id].score}点
                                            </span>
                                        )}
                                    </div>
                                    <p className="text-sm text-purple-100 mt-1">5問の4択問題でこの章の理解度をチェック</p>
                                </button>
                            ) : (
                                <div className="border border-purple-200 rounded-lg overflow-hidden">
                                    <div className="bg-purple-500 text-white p-3 flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <span>📝</span>
                                            <span className="font-bold">確認テスト</span>
                                        </div>
                                        <button 
                                            onClick={closeQuiz}
                                            className="text-purple-100 hover:text-white text-sm"
                                        >
                                            閉じる
                                        </button>
                                    </div>
                                    <div className="p-4 bg-purple-50">
                                        {quizData[chapter.id]?.map((q, qIndex) => (
                                            <div key={q.id} className={`mb-4 p-3 rounded-lg ${quizSubmitted ? (quizAnswers[q.id] === q.answer ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200') : 'bg-white border border-gray-200'}`}>
                                                <div className="flex items-start gap-2 mb-2">
                                                    <span className={`px-2 py-0.5 rounded text-xs font-bold ${q.level === 'basic' ? 'bg-blue-100 text-blue-700' : q.level === 'normal' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700'}`}>
                                                        {q.level === 'basic' ? '基礎' : q.level === 'normal' ? '標準' : '応用'}
                                                    </span>
                                                    <span className="text-sm font-medium">Q{qIndex + 1}. {q.question}</span>
                                                </div>
                                                <div className="grid grid-cols-1 gap-1 ml-2">
                                                    {q.options.map((option, oIndex) => (
                                                        <button
                                                            key={oIndex}
                                                            onClick={() => selectAnswer(q.id, oIndex)}
                                                            disabled={quizSubmitted}
                                                            className={`p-2 text-left text-sm rounded border transition-colors ${
                                                                quizSubmitted
                                                                    ? oIndex === q.answer
                                                                        ? 'bg-green-200 border-green-400 font-bold'
                                                                        : quizAnswers[q.id] === oIndex
                                                                            ? 'bg-red-200 border-red-400'
                                                                            : 'bg-white border-gray-200'
                                                                    : quizAnswers[q.id] === oIndex
                                                                        ? 'bg-purple-200 border-purple-400'
                                                                        : 'bg-white border-gray-200 hover:bg-purple-50'
                                                            }`}
                                                        >
                                                            <span className="font-medium mr-1">{String.fromCharCode(65 + oIndex)}.</span>
                                                            {option}
                                                        </button>
                                                    ))}
                                                </div>
                                                {quizSubmitted && (
                                                    <div className="mt-2 p-2 bg-white rounded border border-gray-200 text-sm">
                                                        <span className="font-bold text-gray-700">解説：</span> {q.explanation}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                        <div className="mt-4">
                                            {!quizSubmitted ? (
                                                <button
                                                    onClick={() => submitQuiz(chapter.id)}
                                                    disabled={Object.keys(quizAnswers).length < (quizData[chapter.id]?.length || 5)}
                                                    className={`w-full py-3 rounded-lg font-bold text-white transition-colors ${
                                                        Object.keys(quizAnswers).length < (quizData[chapter.id]?.length || 5)
                                                            ? 'bg-gray-300 cursor-not-allowed'
                                                            : 'bg-purple-600 hover:bg-purple-700'
                                                    }`}
                                                >
                                                    採点する（{Object.keys(quizAnswers).length}/{quizData[chapter.id]?.length || 5}問回答済み）
                                                </button>
                                            ) : (
                                                <div className="text-center bg-white p-4 rounded-lg border border-gray-200">
                                                    <p className="text-xl font-bold mb-2">
                                                        結果: {quizResults[chapter.id]?.correct}/{quizResults[chapter.id]?.total}問正解
                                                        <span className={`ml-2 ${quizResults[chapter.id]?.score >= 80 ? 'text-green-600' : quizResults[chapter.id]?.score >= 60 ? 'text-yellow-600' : 'text-red-600'}`}>
                                                            ({quizResults[chapter.id]?.score}点)
                                                        </span>
                                                    </p>
                                                    <p className="text-sm text-gray-500">
                                                        {quizResults[chapter.id]?.score >= 80 ? '🎉 すばらしい！よく理解できています' : quizResults[chapter.id]?.score >= 60 ? '👍 もう少しで合格！復習してみよう' : '📚 動画で復習してから再挑戦しよう'}
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            )}


                        </div>
                    </div>
                </div>
            );
        };

        // メインアプリ
        const App = () => {
            const [progress, setProgress] = React.useState(loadProgress());
            const [selectedGrade, setSelectedGrade] = React.useState("1");
            const [selectedDomain, setSelectedDomain] = React.useState(null);
            const [selectedChapter, setSelectedChapter] = React.useState(null);
            const [currentChapter, setCurrentChapter] = React.useState(null);
            const [showHelp, setShowHelp] = React.useState(false);
            
            // 確認テスト関連のstate
            const [showQuiz, setShowQuiz] = React.useState(false);
            const [quizAnswers, setQuizAnswers] = React.useState({});
            const [quizSubmitted, setQuizSubmitted] = React.useState(false);
            const [quizResults, setQuizResults] = React.useState(() => {
                const saved = localStorage.getItem('rikanavi_quiz_results');
                return saved ? JSON.parse(saved) : {};
            });

            // チャットボット関連のstate
            const [showChat, setShowChat] = React.useState(false);
            const [chatMessages, setChatMessages] = React.useState(() => {
                const saved = localStorage.getItem('rikanavi_chat_history');
                return saved ? JSON.parse(saved) : [];
            });
            const [chatInput, setChatInput] = React.useState('');
            const [chatLoading, setChatLoading] = React.useState(false);

            // クイズ結果を保存
            const saveQuizResults = (results) => {
                localStorage.setItem('rikanavi_quiz_results', JSON.stringify(results));
            };

            // クイズを開始
            const startQuiz = () => {
                setQuizAnswers({});
                setQuizSubmitted(false);
                setShowQuiz(true);
            };

            // 回答を選択
            const selectAnswer = (questionId, answerIndex) => {
                if (!quizSubmitted) {
                    setQuizAnswers(prev => ({...prev, [questionId]: answerIndex}));
                }
            };

            // クイズを採点
            const submitQuiz = (chapterId) => {
                if (!chapterId || !quizData[chapterId]) return;
                const questions = quizData[chapterId];
                let correct = 0;
                questions.forEach(q => {
                    if (quizAnswers[q.id] === q.answer) correct++;
                });
                const score = Math.round((correct / questions.length) * 100);
                const newResults = {...quizResults, [chapterId]: {score, correct, total: questions.length, date: new Date().toISOString()}};
                setQuizResults(newResults);
                saveQuizResults(newResults);
                setQuizSubmitted(true);
            };

            // クイズを閉じる
            const closeQuiz = () => {
                setShowQuiz(false);
                setQuizAnswers({});
                setQuizSubmitted(false);
            };


            // チャット履歴を保存
            const saveChatHistory = (messages) => {
                localStorage.setItem('rikanavi_chat_history', JSON.stringify(messages));
            };

            // チャットをリセット
            const resetChat = () => {
                setChatMessages([]);
                localStorage.removeItem('rikanavi_chat_history');
            };

            // システムプロンプトを生成
            const generateSystemPrompt = () => {
                // 完了済みの章とテスト結果を取得
                const completedChapters = [];
                const testResults = [];
                Object.keys(progress).forEach(chapterId => {
                    if (progress[chapterId]) {
                        completedChapters.push(chapterId);
                    }
                });
                Object.keys(quizResults).forEach(chapterId => {
                    const result = quizResults[chapterId];
                    testResults.push(`${chapterId}: ${result.score}点`);
                });

                // 全章のリストを生成
                let allChapters = [];
                Object.entries(curriculumData.grades).forEach(([grade, data]) => {
                    data.units.forEach(unit => {
                        unit.chapters.forEach(chapter => {
                            allChapters.push(`${chapter.id} ${chapter.title}（${grade}年生・${unit.name}）`);
                        });
                    });
                });

                return `あなたは中学理科の学習ガイド「りかナビ先生」です。生徒の学習を優しくサポートしてください。

【あなたの役割】
1. 学校での学習進度（教科書のページ番号など）を聞いて、該当する章を提案する
2. 理科に関する質問に答える（わかりやすく、中学生レベルで）
3. 次に学習すべき内容をアドバイスする
4. 興味を持ったことについて一緒に考える

【学習進捗】
完了済みの章: ${completedChapters.length > 0 ? completedChapters.join(', ') : 'まだありません'}
確認テスト結果: ${testResults.length > 0 ? testResults.join(', ') : 'まだありません'}

【全カリキュラム（中学理科）】
${allChapters.join('\n')}

【会話のコツ】
- 親しみやすく、絵文字も使ってOK
- 長すぎない回答を心がける（3-5行程度）
- 必要に応じて、りかナビの機能（確認テスト、動画など）を勧める
- 「〜章の内容を学習してみましょう」と具体的に提案する`;
            };

            // Claude APIにメッセージを送信（バックエンドAPI経由）
            const sendMessage = async () => {
                if (!chatInput.trim() || chatLoading) return;

                const userMessage = chatInput.trim();
                setChatInput('');
                
                // ユーザーメッセージを追加
                const newMessages = [...chatMessages, { role: 'user', content: userMessage }];
                setChatMessages(newMessages);
                setChatLoading(true);

                try {
                    console.log('Sending chat request to backend...');

                    // バックエンドAPIを呼び出し
                    const response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            messages: newMessages,
                            progress: progress,
                            quizResults: quizResults
                        })
                    });

                    console.log('API Response status:', response.status);
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('API Error:', errorData);
                        throw new Error(errorData.error || `API Error: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('API Response:', data);
                    const assistantMessage = data.message;

                    // アシスタントのメッセージを追加
                    const updatedMessages = [...newMessages, { role: 'assistant', content: assistantMessage }];
                    setChatMessages(updatedMessages);
                    saveChatHistory(updatedMessages);
                } catch (error) {
                    console.error('Chat error:', error);
                    console.error('Error details:', error.message, error.stack);
                    const errorMessages = [...newMessages, { 
                        role: 'assistant', 
                        content: `申し訳ありません。エラーが発生しました。\n\nエラー詳細: ${error.message}\n\nブラウザのコンソール(F12)で詳細を確認してください。`
                    }];
                    setChatMessages(errorMessages);
                } finally {
                    setChatLoading(false);
                }
            };

            // Enterキーで送信
            const handleChatKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            };

            // 進捗の切り替え
            const toggleChapter = (chapterId) => {
                const newProgress = { ...progress };
                newProgress[chapterId] = !newProgress[chapterId];
                setProgress(newProgress);
                saveProgress(newProgress);
            };

            // 現在地の設定
            const setAsCurrent = (chapter) => {
                setCurrentChapter(chapter.id);
                setSelectedChapter(chapter);
            };

            // 全体の進捗計算
            const calculateOverallProgress = () => {
                let total = 0;
                let completed = 0;
                Object.values(curriculumData.grades).forEach(grade => {
                    grade.units.forEach(unit => {
                        unit.chapters.forEach(chapter => {
                            total++;
                            if (progress[chapter.id]) completed++;
                        });
                    });
                });
                return total > 0 ? (completed / total) * 100 : 0;
            };

            // 学年ごとの進捗計算
            const calculateGradeProgress = (gradeKey) => {
                const grade = curriculumData.grades[gradeKey];
                let total = 0;
                let completed = 0;
                grade.units.forEach(unit => {
                    unit.chapters.forEach(chapter => {
                        total++;
                        if (progress[chapter.id]) completed++;
                    });
                });
                return total > 0 ? (completed / total) * 100 : 0;
            };

            // 領域ごとの進捗計算
            const calculateDomainProgress = (domainId) => {
                let total = 0;
                let completed = 0;
                Object.values(curriculumData.grades).forEach(grade => {
                    grade.units.forEach(unit => {
                        if (unit.domain === domainId) {
                            unit.chapters.forEach(chapter => {
                                total++;
                                if (progress[chapter.id]) completed++;
                            });
                        }
                    });
                });
                return total > 0 ? (completed / total) * 100 : 0;
            };

            // 領域ごとの単元をフィルタ（学年指定）
            const getUnitsByDomain = (gradeKey, domainId) => {
                return curriculumData.grades[gradeKey].units.filter(unit => 
                    domainId ? unit.domain === domainId : true
                );
            };

            // 領域ごとに全学年の単元を取得
            const getUnitsByDomainAllGrades = (domainId) => {
                const result = [];
                Object.entries(curriculumData.grades).forEach(([gradeKey, grade]) => {
                    grade.units.forEach(unit => {
                        if (unit.domain === domainId) {
                            result.push({ ...unit, grade: gradeKey });
                        }
                    });
                });
                return result;
            };

            // 学年ビュー（1年生、2年生、3年生）
            const renderGradeView = () => (
                <div className="space-y-6">
                    {getUnitsByDomain(selectedGrade, selectedDomain).map(unit => {
                        const domain = curriculumData.domains.find(d => d.id === unit.domain);
                        const completedChapters = unit.chapters.filter(ch => progress[ch.id]).length;
                        const unitProgress = (completedChapters / unit.chapters.length) * 100;
                        
                        return (
                            <div key={unit.id} className="bg-white rounded-xl shadow-sm overflow-hidden">
                                <div 
                                    className="p-4 flex items-center gap-3"
                                    style={{ backgroundColor: domain.color + '20' }}
                                >
                                    <span className="text-2xl">{domain.icon}</span>
                                    <div className="flex-1">
                                        <h3 className="font-bold text-gray-800">
                                            単元{unit.unitNumber}：{unit.title}
                                        </h3>
                                        <p className="text-sm text-gray-500">
                                            {completedChapters}/{unit.chapters.length} 章完了
                                        </p>
                                    </div>
                                    <div 
                                        className="w-24 h-2 bg-gray-200 rounded-full overflow-hidden"
                                    >
                                        <div 
                                            className="h-full transition-all duration-500"
                                            style={{ 
                                                width: `${unitProgress}%`,
                                                backgroundColor: domain.color
                                            }}
                                        />
                                    </div>
                                </div>
                                <div className="p-4 grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
                                    {unit.chapters.map(chapter => (
                                        <ChapterCard
                                            key={chapter.id}
                                            chapter={chapter}
                                            domain={unit.domain}
                                            isCompleted={progress[chapter.id]}
                                            isCurrent={currentChapter === chapter.id}
                                            onToggle={toggleChapter}
                                            onSelect={setAsCurrent}
                                            quizScore={quizResults[chapter.id]?.score}
                                        />
                                    ))}
                                </div>
                            </div>
                        );
                    })}
                </div>
            );

            // 中学校ビュー（全学年を領域ごとに表示）
            const renderAllGradesView = () => (
                <div className="space-y-8">
                    {curriculumData.domains
                        .filter(domain => !selectedDomain || selectedDomain === domain.id)
                        .map(domain => {
                            const unitsInDomain = getUnitsByDomainAllGrades(domain.id);
                            const domainProgress = calculateDomainProgress(domain.id);
                            
                            return (
                                <div key={domain.id} className="bg-white rounded-xl shadow-sm overflow-hidden">
                                    {/* 領域ヘッダー */}
                                    <div 
                                        className="p-4 flex items-center gap-3"
                                        style={{ backgroundColor: domain.color + '30' }}
                                    >
                                        <span className="text-3xl">{domain.icon}</span>
                                        <div className="flex-1">
                                            <h2 className="text-xl font-bold text-gray-800">
                                                {domain.name}
                                            </h2>
                                            <p className="text-sm text-gray-600">
                                                {Math.round(domainProgress)}% 完了
                                            </p>
                                        </div>
                                        <div 
                                            className="w-32 h-3 bg-gray-200 rounded-full overflow-hidden"
                                        >
                                            <div 
                                                className="h-full transition-all duration-500"
                                                style={{ 
                                                    width: `${domainProgress}%`,
                                                    backgroundColor: domain.color
                                                }}
                                            />
                                        </div>
                                    </div>

                                    {/* 学年ごとの単元 */}
                                    <div className="p-4 space-y-4">
                                        {unitsInDomain.map(unit => {
                                            const completedChapters = unit.chapters.filter(ch => progress[ch.id]).length;
                                            const unitProgress = (completedChapters / unit.chapters.length) * 100;
                                            
                                            return (
                                                <div key={unit.id} className="border-l-4 pl-4" style={{ borderColor: domain.color }}>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <span className="text-xs font-bold text-white px-2 py-0.5 rounded" style={{ backgroundColor: domain.color }}>
                                                            {unit.grade}年
                                                        </span>
                                                        <h3 className="font-bold text-gray-800">
                                                            {unit.title}
                                                        </h3>
                                                        <span className="text-sm text-gray-500">
                                                            ({completedChapters}/{unit.chapters.length})
                                                        </span>
                                                    </div>
                                                    <div className="grid gap-2 sm:grid-cols-2 lg:grid-cols-3">
                                                        {unit.chapters.map(chapter => (
                                                            <ChapterCard
                                                                key={chapter.id}
                                                                chapter={chapter}
                                                                domain={unit.domain}
                                                                isCompleted={progress[chapter.id]}
                                                                isCurrent={currentChapter === chapter.id}
                                                                onToggle={toggleChapter}
                                                                onSelect={setAsCurrent}
                                                                quizScore={quizResults[chapter.id]?.score}
                                                            />
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                </div>
            );

            return (
                <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white">
                    {/* ヘッダー */}
                    <header className="bg-white shadow-sm sticky top-0 z-40">
                        <div className="max-w-6xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-800">🔬 りかナビ</h1>
                                        <p className="text-sm text-gray-500">中学理科学習ナビゲーター</p>
                                    </div>
                                    <button
                                        onClick={() => setShowHelp(true)}
                                        className="px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition-colors flex items-center gap-1"
                                    >
                                        <span>📖</span>
                                        <span>使い方</span>
                                    </button>
                                </div>
                                <div className="flex items-center gap-3">
                                    <p className="text-sm text-gray-500">全体の進捗</p>
                                    <ProgressRing percent={calculateOverallProgress()} />
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 py-6">
                        {/* 学年タブ */}
                        <div className="flex gap-2 mb-6 flex-wrap">
                            {["1", "2", "3"].map(grade => (
                                <button
                                    key={grade}
                                    onClick={() => setSelectedGrade(grade)}
                                    className={`px-6 py-3 rounded-lg font-bold transition-all ${
                                        selectedGrade === grade
                                            ? 'bg-blue-600 text-white shadow-lg'
                                            : 'bg-white text-gray-600 hover:bg-gray-100'
                                    }`}
                                >
                                    {grade}年生
                                    <span className="ml-2 text-sm">
                                        ({Math.round(calculateGradeProgress(grade))}%)
                                    </span>
                                </button>
                            ))}
                            <button
                                onClick={() => setSelectedGrade("all")}
                                className={`px-6 py-3 rounded-lg font-bold transition-all ${
                                    selectedGrade === "all"
                                        ? 'bg-purple-600 text-white shadow-lg'
                                        : 'bg-white text-gray-600 hover:bg-gray-100'
                                }`}
                            >
                                🏫 中学校
                                <span className="ml-2 text-sm">
                                    ({Math.round(calculateOverallProgress())}%)
                                </span>
                            </button>
                        </div>

                        {/* 領域フィルター */}
                        <div className="flex flex-wrap gap-2 mb-6">
                            <button
                                onClick={() => setSelectedDomain(null)}
                                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${
                                    !selectedDomain ? 'bg-gray-800 text-white' : 'bg-white text-gray-600 hover:bg-gray-100'
                                }`}
                            >
                                すべて
                            </button>
                            {curriculumData.domains.map(domain => (
                                <button
                                    key={domain.id}
                                    onClick={() => setSelectedDomain(domain.id)}
                                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all flex items-center gap-1`}
                                    style={{
                                        backgroundColor: selectedDomain === domain.id ? domain.color : 'white',
                                        color: selectedDomain === domain.id ? 'white' : '#4b5563'
                                    }}
                                >
                                    {domain.icon} {domain.name}
                                </button>
                            ))}
                        </div>

                        {/* コンテンツ表示 */}
                        {selectedGrade === "all" ? renderAllGradesView() : renderGradeView()}
                    </main>

                    {/* 動画検索モーダル */}
                    {selectedChapter && (
                        <VideoSearch
                            chapter={selectedChapter}
                            onClose={() => { setSelectedChapter(null); closeQuiz(); }}
                            showQuiz={showQuiz}
                            quizAnswers={quizAnswers}
                            quizSubmitted={quizSubmitted}
                            quizResults={quizResults}
                            startQuiz={startQuiz}
                            selectAnswer={selectAnswer}
                            submitQuiz={submitQuiz}
                            closeQuiz={closeQuiz}
                        />
                    )}

                    {/* 使い方モーダル */}
                    {showHelp && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                            onClick={() => setShowHelp(false)}
                        >
                            <div 
                                className="bg-white rounded-xl max-w-lg w-full overflow-hidden"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                                    <h3 className="text-lg font-bold">📖 使い方</h3>
                                    <button onClick={() => setShowHelp(false)} className="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                                </div>
                                <div className="p-6">
                                    <ul className="text-sm text-gray-600 space-y-3">
                                        <li className="flex gap-2">
                                            <span className="text-green-500">▶</span>
                                            <span>章をクリックすると、学習に役立つ動画などが探せます</span>
                                        </li>
                                        <li className="flex gap-2">
                                            <span className="text-green-500">▶</span>
                                            <span>章の学習が完了したら、右はしの「○」をクリックしましょう</span>
                                        </li>
                                        <li className="flex gap-2">
                                            <span className="text-green-500">▶</span>
                                            <span>学習の記録は、自動で保存されます</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* チャットボット */}
                    {!showChat ? (
                        <button
                            onClick={() => setShowChat(true)}
                            className="fixed bottom-6 right-6 w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all flex flex-col items-center justify-center z-50"
                            style={{animation: 'bounce 2s infinite'}}
                        >
                            <span className="text-2xl">💬</span>
                            <span className="text-xs font-bold mt-0.5">学習ガイド</span>
                        </button>
                    ) : (
                        <div 
                            className="fixed bottom-6 right-6 bg-white rounded-2xl shadow-2xl flex flex-col z-50"
                            style={{width: '380px', height: '500px'}}
                        >
                            {/* ヘッダー */}
                            <div className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-4 rounded-t-2xl flex items-center justify-between" style={{flexShrink: 0}}>
                                <div className="flex items-center gap-2">
                                    <span className="text-2xl">🤖</span>
                                    <div>
                                        <div className="font-bold">りかナビ先生</div>
                                        <div className="text-xs text-indigo-100">学習ガイド</div>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setShowChat(false)}
                                    className="text-white hover:text-indigo-100 text-2xl"
                                >
                                    ×
                                </button>
                            </div>

                            {/* メッセージ一覧 */}
                            <div className="flex-1 p-4 space-y-3" style={{overflowY: 'auto'}}>
                                {chatMessages.length === 0 && (
                                    <div className="text-center text-gray-500 mt-8">
                                        <p className="text-4xl mb-2">👋</p>
                                        <p className="text-sm">こんにちは！</p>
                                        <p className="text-sm">何か聞きたいことはありますか？</p>
                                        <div className="mt-4 text-xs text-gray-400 space-y-1">
                                            <p>💡 「今週教科書P.20まで進んだ」</p>
                                            <p>💡 「次は何を勉強すればいい？」</p>
                                            <p>💡 「光合成について教えて」</p>
                                        </div>
                                    </div>
                                )}
                                {chatMessages.map((msg, idx) => (
                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[80%] p-3 rounded-2xl text-sm ${
                                            msg.role === 'user' 
                                                ? 'bg-indigo-500 text-white rounded-br-none' 
                                                : 'bg-gray-100 text-gray-800 rounded-bl-none'
                                        }`}>
                                            <div className="whitespace-pre-wrap">{msg.content}</div>
                                        </div>
                                    </div>
                                ))}
                                {chatLoading && (
                                    <div className="flex justify-start">
                                        <div className="bg-gray-100 p-3 rounded-2xl rounded-bl-none">
                                            <div className="flex gap-1">
                                                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0s'}}></div>
                                                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                                <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* 入力欄 */}
                            <div className="border-t p-3" style={{flexShrink: 0}}>
                                <div className="flex gap-2 mb-2">
                                    <input
                                        type="text"
                                        value={chatInput}
                                        onChange={(e) => setChatInput(e.target.value)}
                                        onKeyPress={handleChatKeyPress}
                                        placeholder="メッセージを入力..."
                                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-indigo-500"
                                        disabled={chatLoading}
                                    />
                                    <button
                                        onClick={sendMessage}
                                        disabled={!chatInput.trim() || chatLoading}
                                        className={`px-4 py-2 rounded-lg text-white font-bold text-sm transition-colors ${
                                            !chatInput.trim() || chatLoading
                                                ? 'bg-gray-300 cursor-not-allowed'
                                                : 'bg-indigo-500 hover:bg-indigo-600'
                                        }`}
                                    >
                                        送信
                                    </button>
                                </div>
                                <button
                                    onClick={resetChat}
                                    className="w-full text-xs text-gray-500 hover:text-gray-700 py-1"
                                >
                                    🗑️ 会話をリセット
                                </button>
                            </div>
                        </div>
                    )}

                    {/* フッター */}
                    <footer className="mt-12 py-6 text-center text-sm text-gray-500">
                        <p>りかナビ - LODチャレンジ2025応募作品</p>
                        <p className="mt-1">データソース: <a href="https://jp-textbook.github.io/" target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:underline">教科書LOD</a> / <a href="https://jp-cos.github.io/" target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:underline">学習指導要領LOD</a> / <a href="https://school-api-portal.nhk.or.jp/" target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:underline">NHK for School API</a></p>
                        <p className="mt-1 text-xs text-gray-400">教科書: 新しい科学（東京書籍）2020年検定</p>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
